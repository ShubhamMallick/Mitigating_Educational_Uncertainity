<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Career Guidance & Path Visualization</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/ScrollTrigger.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4cc9f0;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4bb543;
            --warning: #f9c74f;
            --danger: #ef476f;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            min-height: 100vh;
            padding: 20px;
            opacity: 0;
            animation: fadeIn 0.8s ease-out forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .container {
            max-width: 1400px;
            margin: 20px auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transform: translateY(0);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .container:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 50px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
            pointer-events: none;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 15px;
            font-weight: 600;
            position: relative;
            display: inline-block;
            animation: slideInDown 0.8s ease-out;
        }
        
        .header h1::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: var(--accent);
            border-radius: 2px;
        }

        .header .subtitle {
            font-size: 1.3em;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
            animation: fadeInUp 0.8s ease-out 0.2s both;
        }

        .content {
            padding: 40px;
        }

        .assessment-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .summary-card {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }

        .summary-card h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .stream-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 0.9em;
            margin-bottom: 20px;
        }

        .score-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .score-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .score-label {
            color: #555;
        }

        .score-value {
            font-weight: bold;
            color: #667eea;
        }

        .charts-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid #f0f0f0;
            min-height: 350px;
            display: flex;
            flex-direction: column;
        }

        .chart-container h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.2em;
        }

        .chart-container canvas {
            flex: 1;
            width: 100% !important;
            height: auto !important;
            max-height: 300px;
            min-height: 200px;
        }

        .career-paths {
            margin-bottom: 50px;
        }

        .career-paths h2 {
            color: #333;
            margin-bottom: 30px;
            font-size: 2em;
            text-align: center;
        }

        .stream-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 10px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 28px;
            border: none;
            background: #f8f9fa;
            color: #666;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 1em;
            font-weight: 500;
            position: relative;
            overflow: hidden;
            z-index: 1;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        
        .tab-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            z-index: -1;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: scale(0.9);
            border-radius: 30px;
        }

        .tab-btn.active {
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.3);
        }
        
        .tab-btn.active::before {
            opacity: 1;
            transform: scale(1);
        }

        .tab-btn:hover {
            transform: translateY(-2px);
            color: var(--primary);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.2);
        }
        
        .tab-btn:hover::before {
            opacity: 0.1;
            transform: scale(1);
        }

        .career-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .career-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .career-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .career-card:hover {
            transform: translateY(-8px) scale(1.01);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
        }
        
        .career-card:hover::before {
            transform: scaleX(1);
        }

        .career-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 25px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .career-header::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }
        
        .career-card:hover .career-header::after {
            transform: translateX(100%);
        }

        .career-title {
            font-size: 1.4em;
            margin-bottom: 8px;
            font-weight: 600;
            position: relative;
            display: inline-block;
        }
        
        .career-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 2px;
            background: rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
        }
        
        .career-card:hover .career-title::after {
            width: 60px;
            background: var(--accent);
        }

        .career-type {
            font-size: 0.9em;
            opacity: 0.9;
            background: rgba(0, 0, 0, 0.1);
            display: inline-block;
            padding: 3px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 500;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
        }

        .career-body {
            padding: 25px;
            position: relative;
            z-index: 1;
        }
        
        .career-body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.03) 0%, rgba(76, 201, 240, 0.03) 100%);
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .career-card:hover .career-body::before {
            opacity: 1;
        }

        .career-description {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.7;
            transition: color 0.3s ease;
        }
        
        .career-card:hover .career-description {
            color: #444;
        }

        .career-details h4 {
            color: #333;
            margin: 15px 0 10px 0;
            font-size: 1.1em;
        }

        .career-details ul {
            margin-left: 20px;
            color: #555;
        }

        .career-details li {
            margin-bottom: 5px;
            line-height: 1.5;
        }

        .skills-required {
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.05) 0%, rgba(76, 201, 240, 0.05) 100%);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid rgba(67, 97, 238, 0.1);
            transition: all 0.3s ease;
        }
        
        .career-card:hover .skills-required {
            border-color: rgba(67, 97, 238, 0.2);
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.08) 0%, rgba(76, 201, 240, 0.08) 100%);
        }

        .skills-required h5 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .exam-prep {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.05) 0%, rgba(255, 152, 0, 0.05) 100%);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 193, 7, 0.15);
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }
        
        .career-card:hover .exam-prep {
            border-color: rgba(255, 193, 7, 0.3);
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.08) 0%, rgba(255, 152, 0, 0.08) 100%);
        }

        .exam-prep h5 {
            color: #ff9500;
            margin-bottom: 10px;
        }

        .course-list {
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.05) 0%, rgba(32, 201, 151, 0.05) 100%);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(40, 167, 69, 0.15);
            transition: all 0.3s ease;
        }
        
        .career-card:hover .course-list {
            border-color: rgba(40, 167, 69, 0.3);
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.08) 0%, rgba(32, 201, 151, 0.08) 100%);
        }

        .course-list h5 {
            color: #28a745;
            margin-bottom: 10px;
        }

        .career-visualization {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            margin-bottom: 50px;
            border: 1px solid rgba(0, 0, 0, 0.03);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
        }
        
        .career-visualization::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(0deg, var(--primary), var(--accent));
            transform: scaleY(0);
            transform-origin: top;
            transition: transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .career-visualization:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
        }
        
        .career-visualization:hover::before {
            transform: scaleY(1);
        }

        .career-visualization h3 {
            color: #333;
            margin-bottom: 25px;
            text-align: center;
            font-size: 1.6em;
            font-weight: 600;
            position: relative;
            display: inline-block;
            left: 50%;
            transform: translateX(-50%);
            padding-bottom: 10px;
        }
        
        .career-visualization h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 3px;
        }

        #careerPathSVG {
            width: 100%;
            height: 500px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            border-radius: 10px;
            background: #fcfcff;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.03);
            transition: all 0.3s ease;
        }
        
        .career-visualization:hover #careerPathSVG {
            border-color: rgba(67, 97, 238, 0.1);
            box-shadow: inset 0 2px 15px rgba(0, 0, 0, 0.05);
        }

        .career-node {
            cursor: pointer;
        }

        .career-node circle {
            stroke: var(--primary);
            stroke-width: 2px;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            filter: drop-shadow(0 2px 4px rgba(67, 97, 238, 0.1));
        }

        .career-node:hover circle {
            stroke: var(--accent);
            stroke-width: 3px;
            filter: drop-shadow(0 4px 8px rgba(76, 201, 240, 0.3));
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { r: 12; }
            50% { r: 14; }
            100% { r: 12; }
        }

        .career-node text {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 12px;
            text-anchor: middle;
            dominant-baseline: middle;
        }

        .career-link {
            stroke: #ccc;
            stroke-width: 2px;
            stroke-opacity: 0.8;
            transition: all 0.4s ease;
        }
        
        .career-node:hover ~ .career-link {
            stroke: var(--accent);
            stroke-opacity: 1;
            stroke-width: 2.5px;
        }

        .career-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            pointer-events: none;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000;
            max-width: 250px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transform: translate(-50%, -100%) scale(0.95);
            transform-origin: center bottom;
        }
        
        .career-tooltip::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid rgba(0, 0, 0, 0.9);
        }

        .career-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .compatibility-badge {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-top: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .compatibility-badge::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.2), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }
        
        .compatibility-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }
        
        .compatibility-badge:hover::after {
            transform: translateX(100%);
        }

        .compatibility-high {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .compatibility-medium {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .compatibility-low {
            background: linear-gradient(135deg, #dc3545, #e83e8c);
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .compatibility-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        
        .compatibility-section:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .compatibility-score {
            font-weight: bold;
            color: #667eea;
            font-size: 1.2em;
        }

        .compatibility-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }

        .compatibility-fill {
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .compatibility-fill.compatibility-high {
            background: linear-gradient(90deg, #28a745, #20c997);
        }

        .compatibility-fill.compatibility-medium {
            background: linear-gradient(90deg, #ffc107, #fd7e14);
        }

        .compatibility-fill.compatibility-low {
            background: linear-gradient(90deg, #dc3545, #e83e8c);
        }

        /* Add smooth scroll behavior */
        html {
            scroll-behavior: smooth;
        }
        
        /* Add animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Add animation classes */
        .animate-fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }
        
        .animate-fade-in-up {
            animation: fadeInUp 0.8s ease-out forwards;
        }
        
        .animate-delay-1 {
            animation-delay: 0.2s;
        }
        
        .animate-delay-2 {
            animation-delay: 0.4s;
        }
        
        /* Responsive styles */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .header {
                padding: 30px 20px;
            }

            .header h1 {
                font-size: 2.2em;
            }

            .content {
                padding: 20px;
            }

            .charts-section {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .chart-container {
                min-height: 280px;
                padding: 20px;
            }

            .chart-container canvas {
                max-height: 250px;
            }

            .assessment-summary {
                grid-template-columns: 1fr;
            }

            .career-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container" data-animate>
        <div class="header" data-animate>
            <h1>Career Guidance & Path Visualization</h1>
            <div class="subtitle">Personalized career recommendations based on your assessment</div>
            <button onclick="goBack()" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; padding: 10px 20px; border-radius: 25px; cursor: pointer; margin-top: 20px; font-size: 0.9em;">← Back to Assessment</button>
        </div>

        <div class="content">
            <!-- Assessment Summary -->
            <div class="assessment-summary">
                <div class="summary-card">
                    <h3>Assessment Overview</h3>
                    <div class="stream-badge" id="streamBadge">Stream: Not Selected</div>
                    <div class="score-grid">
                        <div>
                            <h4 style="margin-bottom: 15px; color: #333;">Subject Scores (/10)</h4>
                            <div class="score-item">
                                <span class="score-label">Mathematics:</span>
                                <span class="score-value" id="mathScore">0.0</span>
                            </div>
                            <div class="score-item">
                                <span class="score-label">Science:</span>
                                <span class="score-value" id="scienceScore">0.0</span>
                            </div>
                            <div class="score-item">
                                <span class="score-label">English:</span>
                                <span class="score-value" id="englishScore">0.0</span>
                            </div>
                            <div class="score-item">
                                <span class="score-label">Social Studies:</span>
                                <span class="score-value" id="socialScore">0.0</span>
                            </div>
                            <div class="score-item">
                                <span class="score-label">Language:</span>
                                <span class="score-value" id="languageScore">0.0</span>
                            </div>
                            <div class="score-item">
                                <span class="score-label">Artistic Skills:</span>
                                <span class="score-value" id="artisticScore">0.0</span>
                            </div>
                            <div class="score-item">
                                <span class="score-label">Biology:</span>
                                <span class="score-value" id="biologyScore">0.0</span>
                            </div>
                        </div>
                        <div>
                            <h4 style="margin-bottom: 15px; color: #333;">Aptitude Scores (/10)</h4>
                            <div class="score-item">
                                <span class="score-label">Logical Reasoning:</span>
                                <span class="score-value" id="logicalScore">0.0</span>
                            </div>
                            <div class="score-item">
                                <span class="score-label">Analytical Skills:</span>
                                <span class="score-value" id="analyticalScore">0.0</span>
                            </div>
                            <div class="score-item">
                                <span class="score-label">Numerical Ability:</span>
                                <span class="score-value" id="numericalScore">0.0</span>
                            </div>
                            <div class="score-item">
                                <span class="score-label">Creativity:</span>
                                <span class="score-value" id="creativityScore">0.0</span>
                            </div>
                            <div class="score-item">
                                <span class="score-label">Communication:</span>
                                <span class="score-value" id="communicationScore">0.0</span>
                            </div>
                            <div class="score-item">
                                <span class="score-label">Practical Skills:</span>
                                <span class="score-value" id="practicalScore">0.0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-section">
                <div class="chart-container">
                    <h3>Subject Scores Overview</h3>
                    <canvas id="subjectsChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>Aptitude Scores Overview</h3>
                    <canvas id="aptitudeChart"></canvas>
                </div>
            </div>

            <!-- Career Path Visualization -->
            <div class="career-visualization" data-animate>
                <h3>Career Progression Path</h3>
                <svg id="careerPathSVG"></svg>
                <div class="career-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #667eea;"></div>
                        <span>Entry Level</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #28a745;"></div>
                        <span>Mid Level</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ffc107;"></div>
                        <span>Senior Level</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #dc3545;"></div>
                        <span>Leadership</span>
                    </div>
                </div>
            </div>

            <!-- Career Paths Section -->
            <div class="career-paths">
                <h2>Personalized Career Recommendations</h2>
                <p style="color: #666; margin-bottom: 30px; text-align: center;">Based on your assessment scores, here are your personalized career matches:</p>

                <div id="careerContent">
                    <!-- Career paths will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Career data for each stream
        const careerData = {
            Science: [
                {
                    title: "Medical Doctor",
                    type: "Healthcare",
                    description: "Diagnose and treat patients, conduct medical research, and improve healthcare outcomes.",
                    skills: ["Biology Knowledge", "Analytical Thinking", "Communication", "Problem Solving"],
                    courses: ["MBBS", "MD/MS", "BDS", "BAMS", "BHMS"],
                    exams: ["NEET", "AIIMS", "JIPMER", "State Medical Exams"],
                    careers: ["General Physician", "Surgeon", "Pediatrician", "Cardiologist", "Neurologist"]
                },
                {
                    title: "Research Scientist",
                    type: "Research & Development",
                    description: "Conduct scientific research to advance knowledge in various fields of science.",
                    skills: ["Scientific Method", "Data Analysis", "Critical Thinking", "Laboratory Skills"],
                    courses: ["B.Sc", "M.Sc", "Ph.D", "B.Tech Biotechnology"],
                    exams: ["CSIR NET", "GATE", "ICAR", "DBT-JRF"],
                    careers: ["Research Associate", "Lab Director", "Professor", "Scientific Advisor"]
                },
                {
                    title: "Engineering",
                    type: "Technology & Innovation",
                    description: "Design, build, and maintain structures, machines, and systems using scientific principles.",
                    skills: ["Mathematics", "Physics", "Problem Solving", "Technical Drawing"],
                    courses: ["B.Tech", "B.E.", "M.Tech", "Diploma Engineering"],
                    exams: ["JEE Main", "JEE Advanced", "State Engineering Exams"],
                    careers: ["Mechanical Engineer", "Civil Engineer", "Software Engineer", "Electrical Engineer"]
                },
                {
                    title: "Data Scientist",
                    type: "Technology & Analytics",
                    description: "Analyze complex data to extract insights and solve business problems using statistical methods.",
                    skills: ["Statistics", "Programming", "Machine Learning", "Data Visualization"],
                    courses: ["B.Tech CS", "B.Sc Statistics", "M.Sc Data Science"],
                    exams: ["No specific exams", "Certifications in Python, R"],
                    careers: ["Data Analyst", "ML Engineer", "Business Intelligence Analyst"]
                },
                {
                    title: "Environmental Scientist",
                    type: "Environmental Protection",
                    description: "Study environmental problems and develop solutions for conservation and sustainability.",
                    skills: ["Environmental Science", "Research", "Policy Analysis", "Field Work"],
                    courses: ["B.Sc Environmental Science", "M.Sc Ecology", "Ph.D Environmental Studies"],
                    exams: ["ICAR", "State PSC", "Environmental Officer Exams"],
                    careers: ["Environmental Consultant", "Conservation Officer", "Policy Advisor"]
                }
            ],
            Commerce: [
                {
                    title: "Chartered Accountant",
                    type: "Finance & Accounting",
                    description: "Provide financial advice, audit accounts, and ensure compliance with financial regulations.",
                    skills: ["Accounting", "Taxation", "Financial Analysis", "Attention to Detail"],
                    courses: ["B.Com", "CA", "CFA", "CPA"],
                    exams: ["CA Foundation", "CA Intermediate", "CA Final"],
                    careers: ["Tax Consultant", "Auditor", "Financial Advisor", "CFO"]
                },
                {
                    title: "Investment Banker",
                    type: "Banking & Finance",
                    description: "Help organizations raise capital and provide strategic financial advice for mergers and acquisitions.",
                    skills: ["Financial Modeling", "Valuation", "Negotiation", "Market Analysis"],
                    courses: ["BBA", "MBA Finance", "CFA", "FRM"],
                    exams: ["CAT", "XAT", "GMAT", "CFA Levels"],
                    careers: ["Investment Banking Analyst", "M&A Advisor", "Portfolio Manager"]
                },
                {
                    title: "Business Analyst",
                    type: "Business Strategy",
                    description: "Analyze business needs and determine solutions to business problems using data-driven insights.",
                    skills: ["Business Acumen", "Data Analysis", "Communication", "Problem Solving"],
                    courses: ["BBA", "MBA", "PGDM", "Business Analytics"],
                    exams: ["CAT", "MAT", "SNAP", "IIFT"],
                    careers: ["Senior Business Analyst", "Strategy Consultant", "Product Manager"]
                },
                {
                    title: "Human Resources Manager",
                    type: "Human Resources",
                    description: "Manage employee relations, recruitment, training, and organizational development.",
                    skills: ["Leadership", "Communication", "Conflict Resolution", "Strategic Planning"],
                    courses: ["BBA HR", "MBA HR", "PGDM HR"],
                    exams: ["CAT", "MAT", "UGC NET"],
                    careers: ["HR Director", "Talent Acquisition Manager", "Training Manager"]
                },
                {
                    title: "Marketing Manager",
                    type: "Marketing & Sales",
                    description: "Develop marketing strategies and campaigns to promote products and services effectively.",
                    skills: ["Market Research", "Brand Management", "Digital Marketing", "Creativity"],
                    courses: ["BBA Marketing", "MBA Marketing", "PGDM Marketing"],
                    exams: ["CAT", "XAT", "Marketing Certifications"],
                    careers: ["Brand Manager", "Digital Marketing Head", "Sales Director"]
                }
            ],
            Arts: [
                {
                    title: "Journalist",
                    type: "Media & Communication",
                    description: "Research, write, and report news stories for newspapers, magazines, and digital media.",
                    skills: ["Writing", "Research", "Interviewing", "Communication"],
                    courses: ["BJMC", "BA Journalism", "MA Mass Communication"],
                    exams: ["No specific exams", "Portfolio-based selection"],
                    careers: ["News Reporter", "Editor", "Content Writer", "Media Consultant"]
                },
                {
                    title: "Lawyer",
                    type: "Legal Services",
                    description: "Provide legal advice, represent clients in court, and help interpret laws and regulations.",
                    skills: ["Legal Research", "Argumentation", "Analytical Thinking", "Communication"],
                    courses: ["LLB", "BA LLB", "LLM"],
                    exams: ["CLAT", "AILET", "LSAT", "State Bar Exams"],
                    careers: ["Corporate Lawyer", "Criminal Lawyer", "Legal Advisor", "Judge"]
                },
                {
                    title: "Psychologist",
                    type: "Healthcare & Wellness",
                    description: "Study human behavior and mental processes to help people overcome psychological challenges.",
                    skills: ["Empathy", "Active Listening", "Research", "Communication"],
                    courses: ["BA Psychology", "MA Psychology", "M.Phil Clinical Psychology"],
                    exams: ["No specific exams", "RCI Registration"],
                    careers: ["Clinical Psychologist", "Counselor", "HR Psychologist"]
                },
                {
                    title: "Graphic Designer",
                    type: "Creative Arts",
                    description: "Create visual concepts and designs for advertisements, websites, and marketing materials.",
                    skills: ["Creativity", "Design Software", "Color Theory", "Typography"],
                    courses: ["BFA", "B.Des", "Diploma Graphic Design"],
                    exams: ["No specific exams", "Portfolio-based"],
                    careers: ["Senior Designer", "Art Director", "UI/UX Designer"]
                },
                {
                    title: "Teacher/Professor",
                    type: "Education",
                    description: "Educate students at various levels and conduct research in academic institutions.",
                    skills: ["Subject Knowledge", "Communication", "Patience", "Leadership"],
                    courses: ["B.Ed", "M.Ed", "Ph.D", "NET Qualification"],
                    exams: ["CTET", "NET", "State Teacher Eligibility Tests"],
                    careers: ["School Teacher", "College Professor", "Principal", "Education Consultant"]
                }
            ],
            PCB: [
                {
                    title: "Medical Doctor",
                    type: "Healthcare",
                    description: "Specialize in diagnosis, treatment, and prevention of diseases with focus on biology and chemistry.",
                    skills: ["Medical Knowledge", "Patient Care", "Diagnostic Skills", "Research"],
                    courses: ["MBBS", "MD", "MS", "BDS"],
                    exams: ["NEET", "AIIMS", "JIPMER"],
                    careers: ["Physician", "Surgeon", "Medical Researcher", "Hospital Administrator"]
                },
                {
                    title: "Biotechnologist",
                    type: "Biotechnology",
                    description: "Apply biological processes to develop new products and technologies for healthcare and agriculture.",
                    skills: ["Molecular Biology", "Genetic Engineering", "Lab Techniques", "Research"],
                    courses: ["B.Tech Biotechnology", "M.Sc Biotechnology", "Ph.D"],
                    exams: ["GATE", "CSIR NET", "ICAR"],
                    careers: ["Research Scientist", "Biotech Engineer", "Quality Control Manager"]
                },
                {
                    title: "Pharmacist",
                    type: "Pharmaceuticals",
                    description: "Prepare and dispense medications while providing drug information to healthcare professionals.",
                    skills: ["Pharmacology", "Chemistry", "Attention to Detail", "Patient Counseling"],
                    courses: ["B.Pharm", "M.Pharm", "Pharm.D"],
                    exams: ["GPAT", "State Pharmacy Council Exams"],
                    careers: ["Clinical Pharmacist", "Drug Inspector", "Pharmaceutical Researcher"]
                },
                {
                    title: "Veterinarian",
                    type: "Animal Healthcare",
                    description: "Provide medical care to animals and work on animal health and welfare issues.",
                    skills: ["Animal Biology", "Surgery", "Diagnosis", "Communication"],
                    courses: ["BVSc & AH", "MVSc", "Ph.D Veterinary Science"],
                    exams: ["NEET", "State Veterinary Exams"],
                    careers: ["Veterinary Doctor", "Animal Researcher", "Zoo Veterinarian"]
                },
                {
                    title: "Nutritionist",
                    type: "Healthcare & Nutrition",
                    description: "Provide dietary advice and develop nutrition plans for individuals and communities.",
                    skills: ["Nutrition Science", "Diet Planning", "Communication", "Research"],
                    courses: ["B.Sc Nutrition", "M.Sc Nutrition", "PG Diploma"],
                    exams: ["No specific exams", "RD Exam for Registered Dietitian"],
                    careers: ["Clinical Nutritionist", "Sports Nutritionist", "Food Consultant"]
                }
            ],
            PCM: [
                {
                    title: "Software Engineer",
                    type: "Technology",
                    description: "Design, develop, and maintain software applications and systems using programming languages.",
                    skills: ["Programming", "Mathematics", "Problem Solving", "Logic"],
                    courses: ["B.Tech CS", "BCA", "MCA", "B.Sc CS"],
                    exams: ["JEE Main", "State Engineering Exams"],
                    careers: ["Full Stack Developer", "Software Architect", "Tech Lead"]
                },
                {
                    title: "Aerospace Engineer",
                    type: "Aerospace & Defense",
                    description: "Design aircraft, spacecraft, and missiles using principles of physics and mathematics.",
                    skills: ["Aerodynamics", "Thermodynamics", "Mathematics", "Physics"],
                    courses: ["B.Tech Aerospace", "M.Tech Aerospace"],
                    exams: ["JEE Advanced", "GATE"],
                    careers: ["Aerospace Design Engineer", "Flight Test Engineer"]
                },
                {
                    title: "Data Analyst",
                    type: "Data & Analytics",
                    description: "Collect, process, and perform statistical analyses on large datasets to inform business decisions.",
                    skills: ["Statistics", "Programming", "Data Visualization", "Mathematics"],
                    courses: ["B.Sc Statistics", "B.Tech CS", "MBA Analytics"],
                    exams: ["No specific exams", "Analytics certifications"],
                    careers: ["Senior Data Analyst", "Business Intelligence Analyst"]
                },
                {
                    title: "Architect",
                    type: "Architecture & Design",
                    description: "Design buildings and structures considering aesthetics, functionality, and safety requirements.",
                    skills: ["Design", "Mathematics", "Physics", "Creativity"],
                    courses: ["B.Arch", "M.Arch", "Diploma Architecture"],
                    exams: ["NATA", "JEE Main Paper 2"],
                    careers: ["Residential Architect", "Commercial Architect", "Urban Planner"]
                },
                {
                    title: "Financial Engineer",
                    type: "Finance & Technology",
                    description: "Use mathematical models and computer science to solve financial problems and create financial products.",
                    skills: ["Financial Mathematics", "Programming", "Risk Management", "Statistics"],
                    courses: ["B.Tech + MBA", "M.Sc Financial Engineering"],
                    exams: ["CAT", "CFA", "FRM"],
                    careers: ["Quantitative Analyst", "Risk Manager", "Financial Modeler"]
                }
            ]
        };

        // Get assessment data from server-rendered template or fallback to session storage
        function getAssessmentData() {
            console.log('=== DATA LOADING DEBUG ===');
            
            // First, check if data was passed from server
            try {
                const serverDataJson = '{{ assessment_data | safe }}';
                if (serverDataJson && serverDataJson !== 'null' && serverDataJson !== 'undefined') {
                    const serverData = JSON.parse(serverDataJson);
                    if (serverData) {
                        console.log('✅ Using server-provided assessment data');
                        // Normalize the data structure
                        const normalizedData = {
                            stream: serverData.stream || serverData.recommendedStream || 'Science',
                            scores: serverData.scores || {},
                            recommendations: serverData.recommendations || [],
                            all_careers: serverData.all_careers || []
                        };
                        console.log('Normalized server data:', normalizedData);
                        return normalizedData;
                    }
                }
            } catch (e) {
                console.error('Error parsing server data:', e);
                console.log('Raw server data:', '{{ assessment_data | safe }}');
            }
            
            // Fallback to session storage
            try {
                const storedData = sessionStorage.getItem('assessmentData');
                if (storedData) {
                    console.log('ℹ️ Using session storage data');
                    const parsedData = JSON.parse(storedData);
                    
                    // Normalize the data structure
                    const normalizedData = {
                        stream: parsedData.stream || parsedData.recommendedStream || 'Science',
                        scores: parsedData.scores || {},
                        recommendations: parsedData.recommendations || [],
                        all_careers: parsedData.all_careers || []
                    };
                    
                    console.log('Normalized session data:', normalizedData);
                    return normalizedData;
                }
            } catch (error) {
                console.error('Error parsing session storage data:', error);
            }
            
            // Fallback to default data with empty recommendations
            console.warn('⚠️ No assessment data found, using fallback data');
            return {
                stream: 'Science',
                scores: {
                    math: 0, science: 0, english: 0, social: 0, language: 0,
                    artistic: 0, biology: 0, logical: 0, analytical: 0,
                    numerical: 0, creativity: 0, communication: 0, practical: 0
                },
                recommendations: [],
                all_careers: []
            };
        }

        // Initialize page
        window.onload = function() {
            try {
                console.log('=== CAREER GUIDANCE PAGE DEBUG ===');

                const data = getAssessmentData();
                console.log('1. Raw sessionStorage data:', data);

                // Check if we have valid data
                if (!data || !data.stream || !data.scores) {
                    console.error('❌ Invalid or missing data structure');
                    console.log('Data received:', data);
                    showErrorMessage('Assessment data is not available. Please complete the assessment first.');
                    return;
                }

                console.log('✅ Data structure is valid');
                console.log('2. Stream:', data.stream);
                console.log('3. Scores object:', data.scores);
                console.log('4. Recommendations count:', data.recommendations ? data.recommendations.length : 'undefined');

                // Display assessment summary
                console.log('5. Displaying assessment summary...');
                displayAssessmentSummary(data);

                // Check if charts should load
                console.log('6. Chart.js available:', typeof Chart !== 'undefined');

                // Wait for Chart.js to load before creating charts
                if (typeof Chart !== 'undefined') {
                    console.log('7. Creating charts immediately...');
                    createCharts(data);
                } else {
                    console.log('8. Waiting for Chart.js to load...');
                    // Wait for Chart.js to load
                    const checkChartJS = setInterval(() => {
                        if (typeof Chart !== 'undefined') {
                            console.log('✅ Chart.js loaded, creating charts...');
                            clearInterval(checkChartJS);
                            createCharts(data);
                        }
                    }, 100);

                    // Timeout after 5 seconds
                    setTimeout(() => {
                        clearInterval(checkChartJS);
                        if (typeof Chart === 'undefined') {
                            console.error('❌ Chart.js failed to load');
                            showErrorMessage('Charts could not be loaded. Please refresh the page.');
                        }
                    }, 5000);
                }

                // Show career recommendations
                console.log('9. Processing career recommendations...');
                if (data.recommendations && data.recommendations.length > 0) {
                    console.log(`✅ Found ${data.recommendations.length} personalized recommendations`);
                    showStreamCareers(data); // Show personalized recommendations
                } else {
                    console.log('⚠️ No personalized recommendations, showing general career paths');
                    showGeneralCareerPaths(data.stream); // Show general career paths
                }

                console.log('=== INITIALIZATION COMPLETE ===');
            } catch (error) {
                console.error('❌ Error initializing page:', error);
                showErrorMessage('An error occurred while loading the page. Please try again.');
            }
        };

        function showGeneralCareerPaths(stream) {
            // Update career path visualization
            updateCareerVisualization(stream);

            const careers = careerData[stream] || [];
            const container = document.getElementById('careerContent');

            if (careers.length === 0) {
                container.innerHTML = '<div class="no-data">No career data available for this stream.</div>';
                return;
            }

            container.innerHTML = careers.map(career => `
                <div class="career-card" data-animate>
                    <div class="career-header">
                        <div class="career-title">${career.title}</div>
                        <div class="career-type">${career.type}</div>
                    </div>
                    <div class="career-body">
                        <div class="career-description">${career.description}</div>

                        <div class="skills-required">
                            <h5>Required Skills:</h5>
                            <ul>
                                ${career.skills.map(skill => `<li>${skill}</li>`).join('')}
                            </ul>
                        </div>

                        <div class="course-list">
                            <h5>Recommended Courses:</h5>
                            <ul>
                                ${career.courses.map(course => `<li>${course}</li>`).join('')}
                            </ul>
                        </div>

                        <div class="exam-prep">
                            <h5>Entrance Exams:</h5>
                            <ul>
                                ${career.exams.map(exam => `<li>${exam}</li>`).join('')}
                            </ul>
                        </div>

                        <div class="career-details">
                            <h4>Career Opportunities:</h4>
                            <ul>
                                ${career.careers.map(career_option => `<li>${career_option}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function showErrorMessage(message) {
            const container = document.getElementById('careerContent');
            container.innerHTML = `
                <div style="text-align: center; padding: 50px; color: #666;">
                    <h3 style="margin-bottom: 20px; color: #333;">Career Guidance</h3>
                    <p style="font-size: 1.1em; margin-bottom: 30px;">${message}</p>
                    <button onclick="window.location.href='career_path_assessment.html'" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; border-radius: 25px; cursor: pointer; font-size: 1em;">← Back to Assessment</button>
                </div>
            `;
        }

        function goBack() {
            window.location.href = 'career_path_assessment.html';
        }

        function displayAssessmentSummary(data) {
            console.log('=== DISPLAY ASSESSMENT SUMMARY DEBUG ===');
            console.log('Data received for summary:', data);

            try {
                // Check if elements exist
                const elements = [
                    'streamBadge', 'mathScore', 'scienceScore', 'englishScore',
                    'socialScore', 'languageScore', 'artisticScore', 'biologyScore',
                    'logicalScore', 'analyticalScore', 'numericalScore', 'creativityScore',
                    'communicationScore', 'practicalScore'
                ];

                for (const elementId of elements) {
                    const element = document.getElementById(elementId);
                    if (!element) {
                        console.error(`❌ Element '${elementId}' not found in DOM`);
                    } else {
                        console.log(`✅ Element '${elementId}' found`);
                    }
                }

                // Update stream badge
                const streamBadge = document.getElementById('streamBadge');
                if (streamBadge) {
                    streamBadge.textContent = `Stream: ${data.stream}`;
                    console.log(`✅ Updated stream badge: ${data.stream}`);
                }

                // Update all score displays
                const scores = data.scores || {};
                console.log('Scores object:', scores);

                if (document.getElementById('mathScore')) {
                    document.getElementById('mathScore').textContent = (scores.math || 0).toFixed(1);
                    console.log(`✅ Updated math score: ${(scores.math || 0).toFixed(1)}`);
                }

                if (document.getElementById('scienceScore')) {
                    document.getElementById('scienceScore').textContent = (scores.science || 0).toFixed(1);
                    console.log(`✅ Updated science score: ${(scores.science || 0).toFixed(1)}`);
                }

                if (document.getElementById('englishScore')) {
                    document.getElementById('englishScore').textContent = (scores.english || 0).toFixed(1);
                    console.log(`✅ Updated english score: ${(scores.english || 0).toFixed(1)}`);
                }

                if (document.getElementById('socialScore')) {
                    document.getElementById('socialScore').textContent = (scores.social || 0).toFixed(1);
                    console.log(`✅ Updated social score: ${(scores.social || 0).toFixed(1)}`);
                }

                if (document.getElementById('languageScore')) {
                    document.getElementById('languageScore').textContent = (scores.language || 0).toFixed(1);
                    console.log(`✅ Updated language score: ${(scores.language || 0).toFixed(1)}`);
                }

                if (document.getElementById('artisticScore')) {
                    document.getElementById('artisticScore').textContent = (scores.artistic || 0).toFixed(1);
                    console.log(`✅ Updated artistic score: ${(scores.artistic || 0).toFixed(1)}`);
                }

                if (document.getElementById('biologyScore')) {
                    document.getElementById('biologyScore').textContent = (scores.biology || 0).toFixed(1);
                    console.log(`✅ Updated biology score: ${(scores.biology || 0).toFixed(1)}`);
                }

                if (document.getElementById('logicalScore')) {
                    document.getElementById('logicalScore').textContent = (scores.logical || 0).toFixed(1);
                    console.log(`✅ Updated logical score: ${(scores.logical || 0).toFixed(1)}`);
                }

                if (document.getElementById('analyticalScore')) {
                    document.getElementById('analyticalScore').textContent = (scores.analytical || 0).toFixed(1);
                    console.log(`✅ Updated analytical score: ${(scores.analytical || 0).toFixed(1)}`);
                }

                if (document.getElementById('numericalScore')) {
                    document.getElementById('numericalScore').textContent = (scores.numerical || 0).toFixed(1);
                    console.log(`✅ Updated numerical score: ${(scores.numerical || 0).toFixed(1)}`);
                }

                if (document.getElementById('creativityScore')) {
                    document.getElementById('creativityScore').textContent = (scores.creativity || 0).toFixed(1);
                    console.log(`✅ Updated creativity score: ${(scores.creativity || 0).toFixed(1)}`);
                }

                if (document.getElementById('communicationScore')) {
                    document.getElementById('communicationScore').textContent = (scores.communication || 0).toFixed(1);
                    console.log(`✅ Updated communication score: ${(scores.communication || 0).toFixed(1)}`);
                }

                if (document.getElementById('practicalScore')) {
                    document.getElementById('practicalScore').textContent = (scores.practical || 0).toFixed(1);
                    console.log(`✅ Updated practical score: ${(scores.practical || 0).toFixed(1)}`);
                }

                console.log('=== ASSESSMENT SUMMARY DISPLAY COMPLETE ===');
            } catch (error) {
                console.error('❌ Error in displayAssessmentSummary:', error);
            }
        }

        function createCharts(data) {
            try {
                console.log('Creating charts with data:', data);

                // Check if Chart.js is loaded
                if (typeof Chart === 'undefined') {
                    console.error('Chart.js not loaded yet, retrying...');
                    setTimeout(() => createCharts(data), 500);
                    return;
                }

                // Validate data
                if (!data || !data.scores) {
                    console.error('Invalid chart data');
                    return;
                }

                // Subject Scores Chart
                const subjectsCanvas = document.getElementById('subjectsChart');
                if (!subjectsCanvas) {
                    console.error('Subjects chart canvas not found');
                    return;
                }

                const subjectsCtx = subjectsCanvas.getContext('2d');
                if (!subjectsCtx) {
                    console.error('Could not get subjects chart context');
                    return;
                }

                console.log('Creating subject scores radar chart');
                new Chart(subjectsCtx, {
                    type: 'radar',
                    data: {
                        labels: ['Math', 'Science', 'English', 'Social', 'Language', 'Artistic', 'Biology'],
                        datasets: [{
                            label: 'Subject Scores (/10)',
                            data: [
                                data.scores.math || 0,
                                data.scores.science || 0,
                                data.scores.english || 0,
                                data.scores.social || 0,
                                data.scores.language || 0,
                                data.scores.artistic || 0,
                                data.scores.biology || 0
                            ],
                            backgroundColor: 'rgba(102, 126, 234, 0.2)',
                            borderColor: '#667eea',
                            borderWidth: 2,
                            pointBackgroundColor: '#667eea',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: '#667eea'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 1.2, // Better aspect ratio for mobile
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 10,
                                ticks: {
                                    stepSize: 2,
                                    font: {
                                        size: 10 // Smaller font for mobile
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });

                // Aptitude Scores Chart
                const aptitudeCanvas = document.getElementById('aptitudeChart');
                if (!aptitudeCanvas) {
                    console.error('Aptitude chart canvas not found');
                    return;
                }

                const aptitudeCtx = aptitudeCanvas.getContext('2d');
                if (!aptitudeCtx) {
                    console.error('Could not get aptitude chart context');
                    return;
                }

                console.log('Creating aptitude scores bar chart');
                new Chart(aptitudeCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Logical', 'Analytical', 'Numerical', 'Artistic', 'Creativity', 'Communication', 'Practical'],
                        datasets: [{
                            label: 'Aptitude Scores (/10)',
                            data: [
                                data.scores.logical || 0,
                                data.scores.analytical || 0,
                                data.scores.numerical || 0,
                                data.scores.artistic || 0,
                                data.scores.creativity || 0,
                                data.scores.communication || 0,
                                data.scores.practical || 0
                            ],
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.8)',
                                'rgba(54, 162, 235, 0.8)',
                                'rgba(255, 205, 86, 0.8)',
                                'rgba(75, 192, 192, 0.8)',
                                'rgba(153, 102, 255, 0.8)',
                                'rgba(255, 159, 64, 0.8)',
                                'rgba(199, 199, 199, 0.8)'
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 205, 86, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(153, 102, 255, 1)',
                                'rgba(255, 159, 64, 1)',
                                'rgba(199, 199, 199, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 1.5, // Better aspect ratio for mobile bar charts
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 10,
                                ticks: {
                                    font: {
                                        size: 10 // Smaller font for mobile
                                    }
                                }
                            },
                            x: {
                                ticks: {
                                    font: {
                                        size: 9, // Smaller font for mobile
                                        maxRotation: 45 // Rotate labels if needed
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });

                console.log('Charts created successfully');
            } catch (error) {
                console.error('Error creating charts:', error);
                // Show error message in chart containers
                const errorMsg = '<div style="text-align: center; padding: 50px; color: #666;">Chart could not be loaded</div>';
                const subjectsContainer = document.querySelector('.chart-container:first-child');
                const aptitudeContainer = document.querySelector('.chart-container:last-child');

                if (subjectsContainer) {
                    subjectsContainer.innerHTML = '<h3>Subject Scores Overview</h3>' + errorMsg;
                }
                if (aptitudeContainer) {
                    aptitudeContainer.innerHTML = '<h3>Aptitude Scores Overview</h3>' + errorMsg;
                }
            }
        }
        function createCareerPathVisualization(stream) {
            const careers = careerData[stream] || [];
            if (careers.length === 0) return;

            // Clear previous visualization
            d3.select("#careerPathSVG").selectAll("*").remove();

            const svg = d3.select("#careerPathSVG");
            const width = svg.node().getBoundingClientRect().width;
            const height = 500;

            // Create tooltip
            const tooltip = d3.select("body").append("div")
                .attr("class", "career-tooltip")
                .style("opacity", 0);

            // Define career levels for progression
            const careerLevels = {
                0: { level: "Entry Level", color: "#667eea" },
                1: { level: "Mid Level", color: "#28a745" },
                2: { level: "Senior Level", color: "#ffc107" },
                3: { level: "Leadership", color: "#dc3545" }
            };

            // Create nodes with positions based on career level
            const nodes = careers.map((career, index) => ({
                id: index,
                name: career.title,
                type: career.type,
                level: Math.min(3, Math.floor(index / 1.5)), // Distribute across levels
                description: career.description,
                skills: career.skills,
                courses: career.courses,
                exams: career.exams,
                opportunities: career.careers,
                x: width / 4 + (index % 2) * width / 2,
                y: 100 + (Math.floor(index / 2)) * 120
            }));

            // Create links for career progression
            const links = [];
            for (let i = 0; i < nodes.length - 1; i++) {
                if (nodes[i].level <= nodes[i + 1].level) {
                    links.push({
                        source: nodes[i].id,
                        target: nodes[i + 1].id,
                        type: "progression"
                    });
                }
            }

            // Create simulation
            const simulation = d3.forceSimulation(nodes)
                .force("link", d3.forceLink(links).id(d => d.id).distance(80))
                .force("charge", d3.forceManyBody().strength(-300))
                .force("center", d3.forceCenter(width / 2, height / 2))
                .force("collision", d3.forceCollide().radius(40));

            // Draw links
            const link = svg.append("g")
                .attr("class", "career-links")
                .selectAll("line")
                .data(links)
                .enter().append("line")
                .attr("class", "career-link")
                .attr("stroke", "#999")
                .attr("stroke-opacity", 0.6)
                .attr("stroke-width", 2);

            // Draw nodes
            const node = svg.append("g")
                .attr("class", "career-nodes")
                .selectAll("g")
                .data(nodes)
                .enter().append("g")
                .attr("class", "career-node")
                .style("cursor", "pointer");

            // Add circles to nodes
            node.append("circle")
                .attr("r", d => 25 + d.level * 3)
                .attr("fill", d => careerLevels[d.level].color)
                .attr("stroke", "#fff")
                .attr("stroke-width", 2);

            // Add text to nodes
            node.append("text")
                .text(d => d.name.length > 15 ? d.name.substring(0, 15) + "..." : d.name)
                .attr("dy", ".35em")
                .attr("text-anchor", "middle")
                .style("font-size", "11px")
                .style("font-weight", "bold")
                .style("fill", "#333");

            // Add hover effects and tooltips
            node.on("mouseover", function(event, d) {
                    d3.select(this).select("circle")
                        .transition()
                        .duration(200)
                        .attr("stroke", "#ff6b6b")
                        .attr("stroke-width", 3);

                    tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);

                    tooltip.html(`
                        <strong>${d.name}</strong><br/>
                        <em>${d.type}</em><br/>
                        <strong>Level:</strong> ${careerLevels[d.level].level}<br/>
                        <strong>Required:</strong> ${d.skills.slice(0, 2).join(", ")}...
                    `)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function(d) {
                    d3.select(this).select("circle")
                        .transition()
                        .duration(200)
                        .attr("stroke", "#667eea")
                        .attr("stroke-width", 2);

                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                })
                .on("click", function(event, d) {
                    showCareerDetails(d, careerLevels[d.level]);
                });

            // Update positions on simulation tick
            simulation.on("tick", function() {
                link
                    .attr("x1", d => d.source.x)
                    .attr("y1", d => d.source.y)
                    .attr("x2", d => d.target.x)
                    .attr("y2", d => d.target.y);

                node
                    .attr("transform", d => `translate(${d.x},${d.y})`);
            });

            // Drag functionality
            const drag = d3.drag()
                .on("start", function(event, d) {
                    if (!event.active) simulation.alphaTarget(0.3).restart();
                    d.fx = d.x;
                    d.fy = d.y;
                })
                .on("drag", function(event, d) {
                    d.fx = event.x;
                    d.fy = event.y;
                })
                .on("end", function(event, d) {
                    if (!event.active) simulation.alphaTarget(0);
                    d.fx = null;
                    d.fy = null;
                });

            node.call(drag);
        }

        function showCareerDetails(career, levelInfo) {
            // Create a modal or detailed view for the selected career
            const modal = d3.select("body").append("div")
                .attr("class", "career-modal")
                .style("position", "fixed")
                .style("top", "0")
                .style("left", "0")
                .style("width", "100%")
                .style("height", "100%")
                .style("background", "rgba(0,0,0,0.8)")
                .style("z-index", "2000")
                .style("display", "flex")
                .style("align-items", "center")
                .style("justify-content", "center")
                .on("click", function() {
                    d3.select(".career-modal").remove();
                });

            modal.append("div")
                .attr("class", "career-details-modal")
                .style("background", "white")
                .style("padding", "30px")
                .style("border-radius", "15px")
                .style("max-width", "600px")
                .style("max-height", "80vh")
                .style("overflow-y", "auto")
                .style("position", "relative")
                .html(`
                    <button onclick="d3.select('.career-modal').remove()" style="position: absolute; top: 15px; right: 20px; background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">&times;</button>
                    <h2 style="color: #333; margin-bottom: 20px; border-bottom: 2px solid ${levelInfo.color}; padding-bottom: 10px;">${career.name}</h2>
                    <p style="color: #666; font-size: 1.1em; margin-bottom: 20px;"><strong>Type:</strong> ${career.type}</p>
                    <p style="color: #555; line-height: 1.6; margin-bottom: 25px;">${career.description}</p>

                    <div style="margin-bottom: 20px;">
                        <h3 style="color: ${levelInfo.color}; margin-bottom: 10px;">${levelInfo.level} Position</h3>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #333; margin-bottom: 10px;">Required Skills:</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${career.skills.map(skill => `<span style="background: #e3f2fd; color: #1976d2; padding: 4px 12px; border-radius: 15px; font-size: 0.9em;">${skill}</span>`).join('')}
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #333; margin-bottom: 10px;">Recommended Courses:</h4>
                        <ul style="color: #555; line-height: 1.5;">
                            ${career.courses.map(course => `<li>${course}</li>`).join('')}
                        </ul>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #333; margin-bottom: 10px;">Entrance Exams:</h4>
                        <ul style="color: #555; line-height: 1.5;">
                            ${career.exams.map(exam => `<li>${exam}</li>`).join('')}
                        </ul>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #333; margin-bottom: 10px;">Career Opportunities:</h4>
                        <ul style="color: #555; line-height: 1.5;">
                            ${career.opportunities.map(opportunity => `<li>${opportunity}</li>`).join('')}
                        </ul>
                    </div>
                `)
                .on("click", function(event) {
                    event.stopPropagation(); // Prevent modal from closing when clicking inside
                });
        }

        function updateCareerVisualization(stream) {
            createCareerPathVisualization(stream);
        }

        function showStreamCareers(data) {
            console.log('showStreamCareers called with data:', data);
            
            // Get personalized recommendations from the assessment data
            const recommendations = Array.isArray(data.recommendations) ? data.recommendations : [];
            const stream = data.stream || 'Science'; // Default to 'Science' if stream is not provided
            
            // Get the full career data for the stream
            const streamCareers = careerData[stream] || [];
            
            // Update career path visualization
            updateCareerVisualization(stream);

            const container = document.getElementById('careerContent');
            if (!container) {
                console.error('Error: Could not find element with ID "careerContent"');
                return;
            }

            if (!recommendations || recommendations.length === 0) {
                console.log('No recommendations found, showing general career paths');
                showGeneralCareerPaths(stream);
                return;
            }

            // Sort recommendations by compatibility score (highest first)
            const sortedRecommendations = [...recommendations].sort((a, b) => {
                const scoreA = typeof a.compatibility_score === 'number' ? a.compatibility_score : 0;
                const scoreB = typeof b.compatibility_score === 'number' ? b.compatibility_score : 0;
                return scoreB - scoreA;
            });

            container.innerHTML = sortedRecommendations.map(rec => {
                // Find the full career details from the stream data or use the recommendation data
                const career = streamCareers.find(c => c && c.title === rec.title) || {
                    title: rec.title || 'Career Title',
                    type: rec.type || 'General',
                    description: rec.description || 'No description available.',
                    skills: Array.isArray(rec.skills) ? rec.skills : ['No skills information available'],
                    courses: Array.isArray(rec.courses) ? rec.courses : ['No course information available'],
                    exams: Array.isArray(rec.exams) ? rec.exams : ['No exam information available'],
                    careers: Array.isArray(rec.careers) ? rec.careers : ['No career information available']
                };
                
                const compatibilityScore = typeof rec.compatibility_score === 'number' ? rec.compatibility_score : 0;

                // Determine compatibility level for styling
                let compatibilityClass = 'compatibility-low';
                let compatibilityLabel = 'Low Match';

                if (compatibilityScore >= 80) {
                    compatibilityClass = 'compatibility-high';
                    compatibilityLabel = 'Excellent Match';
                } else if (compatibilityScore >= 60) {
                    compatibilityClass = 'compatibility-medium';
                    compatibilityLabel = 'Good Match';
                } else if (compatibilityScore >= 40) {
                    compatibilityClass = 'compatibility-low';
                    compatibilityLabel = 'Fair Match';
                }

                return `
                    <div class="career-card" data-animate>
                        <div class="career-header">
                            <div class="career-title">${career.title}</div>
                            <div class="career-type">${career.type}</div>
                            <div class="compatibility-badge ${compatibilityClass}">
                                ${compatibilityScore.toFixed(1)}% - ${compatibilityLabel}
                            </div>
                        </div>
                        <div class="career-body">
                            <div class="career-description">${career.description}</div>

                            <div class="compatibility-section" data-animate>
                                <h5>Your Compatibility: <span class="compatibility-score">${compatibilityScore.toFixed(1)}%</span></h5>
                                <div class="compatibility-bar">
                                    <div class="compatibility-fill ${compatibilityClass}" style="width: ${compatibilityScore}%"></div>
                                </div>
                            </div>

                            <div class="skills-required">
                                <h5>Required Skills:</h5>
                                <ul>
                                    ${career.skills.map(skill => `<li>${skill}</li>`).join('')}
                                </ul>
                            </div>

                            <div class="course-list">
                                <h5>Recommended Courses:</h5>
                                <ul>
                                    ${career.courses.map(course => `<li>${course}</li>`).join('')}
                                </ul>
                            </div>

                            <div class="exam-prep">
                                <h5>Entrance Exams:</h5>
                                <ul>
                                    ${career.exams.map(exam => `<li>${exam}</li>`).join('')}
                                </ul>
                            </div>

                            <div class="career-details">
                                <h4>Career Opportunities:</h4>
                                <ul>
                                    ${career.careers.map(career_option => `<li>${career_option}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
    </script>
</body>
</html>