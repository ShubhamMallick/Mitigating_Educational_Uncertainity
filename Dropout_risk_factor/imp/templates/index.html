<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Student Dropout Risk Analysis Tool - Identify and mitigate student dropout risks with our comprehensive analysis platform">
    <meta name="keywords" content="student dropout, risk analysis, education, student retention, academic performance">
    <meta name="author" content="AI in Education">
    <meta name="theme-color" content="#3b82f6">
    <title>Student Dropout Risk Analysis | AI in Education</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“Š</text></svg>">
    
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    
    <!-- CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.css" rel="stylesheet">
    <link href="/dropout-risk/static/css/animations.css" rel="stylesheet">
    
    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        /* Base Styles */
        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --primary-light: #93c5fd;
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            --info: #3b82f6;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }
        
        /* Slider Styles */
        .slider-container {
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .slider-container:focus-within {
            transform: translateY(-2px);
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--gray-700);
        }
        
        .slider-value {
            font-weight: 700;
            color: var(--primary);
            min-width: 2.5rem;
            text-align: right;
        }
        input[type="range"] {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--gray-200);
            outline: none;
            padding: 0;
            margin: 10px 0;
            transition: all 0.2s ease;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        input[type="range"]:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            transition: all 0.15s ease-in-out;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            transition: all 0.15s ease-in-out;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        input[type="range"]:hover::-webkit-slider-thumb,
        input[type="range"]:hover::-moz-range-thumb {
            background: var(--primary-dark);
            transform: scale(1.1);
        }
        
        input[type="range"]:active::-webkit-slider-thumb,
        input[type="range"]:active::-moz-range-thumb {
            transform: scale(1.2);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }
        
        /* Disabled state */
        input[type="range"]:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        input[type="range"]:disabled::-webkit-slider-thumb,
        input[type="range"]:disabled::-moz-range-thumb {
            cursor: not-allowed;
            background: var(--gray-400);
        }
        /* Section Styles */
        .section {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.75rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
            border: 1px solid var(--gray-100);
        }
        
        .section:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.25rem;
            color: var(--gray-900);
            border-bottom: 2px solid var(--gray-100);
            padding-bottom: 0.75rem;
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 0.75rem;
            font-size: 1.1em;
        }
        /* Sidebar and Navigation */
        #sidebar {
            transform: translateX(-100%);
        }
        
        #sidebar.expanded {
            transform: translateX(0);
        }
        
        @media (min-width: 768px) {
            #sidebar {
                transform: translateX(0);
            }
            #main-content-area {
                margin-left: 16rem; /* 64 * 4 = 256px - sidebar width */
            }
            #mobile-menu-button {
                display: none;
            }
        }
        
        /* Tab Navigation */
        .tab-button {
            transition: all 0.2s ease;
            position: relative;
            margin-bottom: 0.25rem;
        }
        
        .tab-button:hover {
            background-color: var(--blue-50);
            color: var(--blue-700);
        }
        
        .tab-button.active {
            background-color: var(--blue-50);
            color: var(--blue-700);
            font-weight: 500;
            border-left: 3px solid var(--blue-600);
        }
        
        .tab-button .badge {
            margin-left: 0.5rem;
            background-color: var(--gray-200);
            color: var(--gray-700);
            border-radius: 9999px;
            padding: 0.15rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .tab-button.active .badge {
            background-color: var(--primary-light);
            color: var(--primary-dark);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .risk-indicator {
            height: 10px;
            border-radius: 5px;
            background: linear-gradient(to right, #10b981, #f59e0b, #ef4444);
        }
        .risk-marker {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            border: 3px solid #2563eb;
            position: absolute;
            top: -5px;
            transform: translateX(-50%);
            transition: left 0.3s ease;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #1f2937;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.875rem;
            font-weight: normal;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .resource-card {
            display: block;
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
        }
        .resource-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border-color: #3b82f6;
        }
        /* Add smooth transitions for sidebar */
        .transition-all {
            transition-property: all;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 150ms;
        }
        
        /* Ensure main content is properly spaced */
        main {
            padding-top: 1rem;
        }
        
        /* Adjust section spacing */
        .section {
            margin-bottom: 1.5rem;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
    <!-- Skip to main content link for accessibility -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:fixed focus:top-4 focus:left-4 focus:z-50 focus:bg-white focus:px-4 focus:py-2 focus:rounded focus:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
        Skip to main content
    </a>

    <!-- Main Layout with Sidebar -->
    <div class="flex flex-1 overflow-hidden">
        <!-- Sidebar -->
        <div id="sidebar" class="bg-white w-64 flex-shrink-0 border-r border-gray-200 flex flex-col h-[calc(100vh-4rem)] fixed top-16 left-0 z-30 transition-all duration-300 ease-in-out">
            <div class="p-4 overflow-y-auto">
                <nav class="space-y-1">
                    <button id="tab-risk" class="tab-button w-full text-left px-4 py-3 rounded-lg flex items-center hover:bg-blue-50 text-gray-700 hover:text-blue-700" data-tab="risk-assessment">
                        <i class="fas fa-shield-alt mr-3 text-blue-600"></i>
                        <span>Risk Assessment</span>
                    </button>
                    <button id="tab-trends" class="tab-button w-full text-left px-4 py-3 rounded-lg flex items-center hover:bg-blue-50 text-gray-700 hover:text-blue-700" data-tab="performance-trends">
                        <i class="fas fa-chart-line mr-3 text-blue-600"></i>
                        <span>Performance Trends</span>
                    </button>
                    <button id="tab-progress" class="tab-button w-full text-left px-4 py-3 rounded-lg flex items-center hover:bg-blue-50 text-gray-700 hover:text-blue-700" data-tab="category-progress">
                        <i class="fas fa-tasks mr-3 text-blue-600"></i>
                        <span>Category Progress</span>
                    </button>
                    <button id="tab-goals" class="tab-button w-full text-left px-4 py-3 rounded-lg flex items-center hover:bg-blue-50 text-gray-700 hover:text-blue-700" data-tab="goals-management">
                        <i class="fas fa-bullseye mr-3 text-blue-600"></i>
                        <span>Goals</span>
                    </button>
                    <button id="tab-notes" class="tab-button w-full text-left px-4 py-3 rounded-lg flex items-center hover:bg-blue-50 text-gray-700 hover:text-blue-700" data-tab="notes">
                        <i class="fas fa-sticky-note mr-3 text-blue-600"></i>
                        <span>Notes</span>
                    </button>
                    <button id="tab-resource-library" class="tab-button w-full text-left px-4 py-3 rounded-lg flex items-center hover:bg-blue-50 text-gray-700 hover:text-blue-700" data-tab="resource-library">
                        <i class="fas fa-book mr-3 text-blue-600"></i>
                        <span>Resource Library</span>
                    </button>
                    <button id="tab-quick-actions" class="tab-button w-full text-left px-4 py-3 rounded-lg flex items-center hover:bg-blue-50 text-gray-700 hover:text-blue-700" data-tab="quick-actions">
                        <i class="fas fa-bolt mr-3 text-blue-600"></i>
                        <span>Quick Actions</span>
                    </button>
                    <button id="tab-reminders" class="tab-button w-full text-left px-4 py-3 rounded-lg flex items-center hover:bg-blue-50 text-gray-700 hover:text-blue-700" data-tab="reminders">
                        <i class="fas fa-bell mr-3 text-blue-600"></i>
                        <span>Reminders</span>
                        <span class="ml-auto bg-red-100 text-red-800 text-xs font-semibold px-2 py-0.5 rounded-full">3</span>
                    </button>
                    <button id="tab-study-planner" class="tab-button w-full text-left px-4 py-3 rounded-lg flex items-center hover:bg-blue-50 text-gray-700 hover:text-blue-700" data-tab="study-planner">
                        <i class="fas fa-calendar-alt mr-3 text-blue-600"></i>
                        <span>Study Planner</span>
                    </button>
                </nav>
            </div>
            <!-- Collapse Button -->
            <div class="p-4 border-t border-gray-200 mt-auto">
                <button id="collapse-sidebar" class="w-full flex items-center justify-center text-gray-500 hover:text-gray-700">
                    <i class="fas fa-chevron-left mr-2"></i>
                    <span>Collapse</span>
                </button>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="flex-1 flex flex-col overflow-hidden ml-0 transition-all duration-300 ease-in-out" id="main-content-area">
            <!-- Mobile Menu Button -->
            <button id="mobile-menu-button" class="md:hidden fixed top-4 left-4 z-20 p-2 rounded-md bg-white shadow-md">
                <i class="fas fa-bars text-gray-600"></i>
            </button>

            <main class="flex-1 overflow-y-auto pt-4 pb-8">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="container mx-auto px-4">
                        <div class="mb-8">
                            <h1 class="text-3xl font-bold text-gray-900 mb-2">Student Dropout Risk Analysis</h1>
                            <p class="text-gray-600">Proactively identify at-risk students with our comprehensive analysis platform</p>
                        </div>
        
        <!-- Main Content Area -->

        <!-- Risk Assessment Tab -->
        <div id="risk-assessment" class="tab-content active">
            <form id="riskForm" class="space-y-6">
            <!-- Error container -->
            <div id="errorContainer" class="hidden"></div>
            <!-- Academic Performance Section -->
            <div class="section">
                <h2 class="section-title">1. Academic Performance</h2>
                
                <!-- Course Grades -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Course Grades (Current GPA)</span>
                        <span class="slider-value" id="gradesValue">5.0</span>
                    </div>
                    <input type="range" id="grades" name="grades" min="0" max="10" step="0.1" value="5.0" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>0 (Poor)</span>
                        <span>10 (Excellent)</span>
                    </div>
                </div>

                <!-- Attendance -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Attendance Rate</span>
                        <span class="slider-value" id="attendanceValue">75%</span>
                    </div>
                    <input type="range" id="attendance" name="attendance" min="0" max="100" value="75" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>0%</span>
                        <span>100%</span>
                    </div>
                </div>

                <!-- Assignment Submission -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Assignment Submission Rate</span>
                        <span class="slider-value" id="assignmentsValue">75%</span>
                    </div>
                    <input type="range" id="assignments" name="assignments" min="0" max="100" value="75" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>0%</span>
                        <span>100%</span>
                    </div>
                </div>

                <!-- Exam Performance -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Average Exam Score</span>
                        <span class="slider-value" id="examsValue">60%</span>
                    </div>
                    <input type="range" id="exams" name="exams" min="0" max="100" value="60" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>0%</span>
                        <span>100%</span>
                    </div>
                </div>
            </div>

            <!-- Behavioral Indicators Section -->
            <div class="section bg-blue-50 border border-blue-100">
                <h2 class="section-title text-blue-700">2. Behavioral Indicators</h2>
                
                <!-- Class Participation -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Class Participation Level</span>
                        <span class="slider-value" id="participationValue">50%</span>
                    </div>
                    <input type="range" id="participation" name="participation" min="0" max="100" value="50" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>None</span>
                        <span>Very Active</span>
                    </div>
                </div>

                <!-- Absenteeism -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Unexcused Absences (per month)</span>
                        <span class="slider-value" id="absencesValue">2</span>
                    </div>
                    <input type="range" id="absences" name="absences" min="0" max="10" value="2" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>0</span>
                        <span>10+</span>
                    </div>
                </div>

                <!-- Tardiness -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Late Arrivals (per week)</span>
                        <span class="slider-value" id="tardinessValue">1</span>
                    </div>
                    <input type="range" id="tardiness" name="tardiness" min="0" max="10" value="1" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>Never</span>
                        <span>10+</span>
                    </div>
                </div>

                <!-- Behavioral Issues -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Behavioral Incidents (this term)</span>
                        <span class="slider-value" id="behavioralIssuesValue">0</span>
                    </div>
                    <input type="range" id="behavioralIssues" name="behavioralIssues" min="0" max="10" value="0" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>None</span>
                        <span>10+</span>
                    </div>
                </div>
            </div>

            <!-- Institutional Factors Section -->
            <div class="section risk-card bg-purple-50 border border-purple-100">
                <h2 class="section-title text-purple-700">4. Institutional Factors</h2>
                
                <!-- Course Load -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Course Load (Credits)</span>
                        <span class="slider-value" id="courseLoadValue">15</span>
                    </div>
                    <input type="range" id="courseLoad" name="courseLoad" min="0" max="24" value="15" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>0</span>
                        <span>24+</span>
                    </div>
                </div>

                <!-- Major Fit -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Major Fit (Alignment)</span>
                        <span class="slider-value" id="majorFitValue">70%</span>
                    </div>
                    <input type="range" id="majorFit" name="majorFit" min="0" max="100" value="70" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>Poor Fit</span>
                        <span>Excellent Fit</span>
                    </div>
                </div>

                <!-- Faculty Interaction -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Faculty Interaction (Monthly Visits)</span>
                        <span class="slider-value" id="facultyInteractionValue">2</span>
                    </div>
                    <input type="range" id="facultyInteraction" name="facultyInteraction" min="0" max="10" value="2" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>None</span>
                        <span>10+</span>
                    </div>
                </div>

                <!-- Campus Involvement -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Campus Involvement (Hours/Week)</span>
                        <span class="slider-value" id="campusInvolvementValue">5</span>
                    </div>
                    <input type="range" id="campusInvolvement" name="campusInvolvement" min="0" max="20" value="5" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>0 hours</span>
                        <span>20+ hours</span>
                    </div>
                </div>
            </div>

            <!-- Social Factors Section -->
            <div class="section risk-card bg-yellow-50 border border-yellow-100">
                <h2 class="section-title text-yellow-700">5. Social Factors</h2>
                
                <!-- Peer Network -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Peer Network Strength</span>
                        <span class="slider-value" id="peerNetworkValue">60%</span>
                    </div>
                    <input type="range" id="peerNetwork" name="peerNetwork" min="0" max="100" value="60" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>Weak</span>
                        <span>Strong</span>
                    </div>
                </div>

                <!-- Mentorship -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Mentorship Access</span>
                        <span class="slider-value" id="mentorshipValue">50%</span>
                    </div>
                    <input type="range" id="mentorship" name="mentorship" min="0" max="100" value="50" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>No Access</span>
                        <span>Excellent Access</span>
                    </div>
                </div>

                <!-- Bullying -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Bullying Experience</span>
                        <span class="slider-value" id="bullyingValue">10%</span>
                    </div>
                    <input type="range" id="bullying" name="bullying" min="0" max="100" value="10" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>None</span>
                        <span>Severe</span>
                    </div>
                </div>
            </div>

            <!-- Psychological Factors Section -->
            <div class="section bg-pink-50 border border-pink-100">
                <h2 class="section-title text-pink-700">7. Psychological Factors</h2>
                
                <!-- Motivation -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Self-Reported Motivation</span>
                        <span class="slider-value" id="motivationValue">70%</span>
                    </div>
                    <input type="range" id="motivation" name="motivation" min="0" max="100" value="70" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>Low</span>
                        <span>High</span>
                    </div>
                </div>

                <!-- Self-Efficacy -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Academic Self-Efficacy</span>
                        <span class="slider-value" id="selfEfficacyValue">65%</span>
                    </div>
                    <input type="range" id="selfEfficacy" name="selfEfficacy" min="0" max="100" value="65" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>Low</span>
                        <span>High</span>
                    </div>
                </div>

                <!-- Stress Levels -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Perceived Stress Level</span>
                        <span class="slider-value" id="stressLevelValue">40%</span>
                    </div>
                    <input type="range" id="stressLevel" name="stressLevel" min="0" max="100" value="40" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>Low</span>
                        <span>High</span>
                    </div>
                </div>
            </div>

            <!-- Historical Data Section -->
            <div class="section risk-card bg-amber-50 border border-amber-100">
                <h2 class="section-title text-amber-700">8. Historical Data</h2>
                
                <!-- Previous Dropout -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Previous Dropout History</span>
                        <span class="slider-value" id="previousDropoutValue">0%</span>
                    </div>
                    <input type="range" id="previousDropout" name="previousDropout" min="0" max="100" value="0" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>None</span>
                        <span>Multiple</span>
                    </div>
                </div>

                <!-- Grade Retention -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Grade Retention History</span>
                        <span class="slider-value" id="gradeRetentionValue">0%</span>
                    </div>
                    <input type="range" id="gradeRetention" name="gradeRetention" min="0" max="100" value="0" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>None</span>
                        <span>Multiple</span>
                    </div>
                </div>

                <!-- School Changes -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>School Transfers (Last 3 Years)</span>
                        <span class="slider-value" id="schoolChangesValue">0</span>
                    </div>
                    <input type="range" id="schoolChanges" name="schoolChanges" min="0" max="10" value="0" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>0</span>
                        <span>10+</span>
                    </div>
                </div>
            </div>

            <!-- Digital Footprint Section -->
            <div class="section bg-teal-50 border border-teal-100">
                <h2 class="section-title text-teal-700">9. Digital Footprint</h2>
                
                <!-- LMS Activity -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>LMS Activity (Logins/Week)</span>
                        <span class="slider-value" id="lmsActivityValue">5</span>
                    </div>
                    <input type="range" id="lmsActivity" name="lmsActivity" min="0" max="20" value="5" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>0</span>
                        <span>20+</span>
                    </div>
                </div>

                <!-- Online Engagement -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Online Forum Participation</span>
                        <span class="slider-value" id="onlineEngagementValue">50%</span>
                    </div>
                    <input type="range" id="onlineEngagement" name="onlineEngagement" min="0" max="100" value="50" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>None</span>
                        <span>Very Active</span>
                    </div>
                </div>
            </div>

            <!-- Early Warning Indicators Section -->
            <div class="section risk-card bg-rose-50 border border-rose-100">
                <h2 class="section-title text-rose-700">10. Early Warning Indicators</h2>
                
                <!-- Warning Signs -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Warning Signs (Failing Grades, Attendance)</span>
                        <span class="slider-value" id="warningSignsValue">10%</span>
                    </div>
                    <input type="range" id="warningSigns" name="warningSigns" min="0" max="100" value="10" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>None</span>
                        <span>Multiple</span>
                    </div>
                </div>

                <!-- Early Alerts -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Faculty-Submitted Concerns</span>
                        <span class="slider-value" id="earlyAlertsValue">10%</span>
                    </div>
                    <input type="range" id="earlyAlerts" name="earlyAlerts" min="0" max="100" value="10" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>None</span>
                        <span>Multiple</span>
                    </div>
                </div>
            </div>

            <!-- External Factors Section -->
            <div class="section bg-indigo-50 border border-indigo-100">
                <h2 class="section-title text-indigo-700">6. External Factors</h2>
                
                <!-- Commute Time -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Daily Commute (Minutes)</span>
                        <span class="slider-value" id="commuteTimeValue">30</span>
                    </div>
                    <input type="range" id="commuteTime" name="commuteTime" min="0" max="180" value="30" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>0 min</span>
                        <span>3+ hours</span>
                    </div>
                </div>

                <!-- Family Responsibilities -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Family Care Hours/Week</span>
                        <span class="slider-value" id="familyResponsibilitiesValue">5</span>
                    </div>
                    <input type="range" id="familyResponsibilities" name="familyResponsibilities" min="0" max="50" value="5" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>0 hours</span>
                        <span>50+ hours</span>
                    </div>
                </div>

                <!-- Work-Life Balance -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Work-Life Balance</span>
                        <span class="slider-value" id="workLifeBalanceValue">60%</span>
                    </div>
                    <input type="range" id="workLifeBalance" name="workLifeBalance" min="0" max="100" value="60" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>Poor</span>
                        <span>Excellent</span>
                    </div>
                </div>
            </div>

            <!-- Personal Factors Section -->
            <div class="section risk-card bg-green-50 border border-green-100">
                <h2 class="section-title text-green-700">3. Personal Factors</h2>
                
                <!-- Financial Situation -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Financial Stress Level</span>
                        <span class="slider-value" id="financialStressValue">30%</span>
                    </div>
                    <input type="range" id="financialStress" name="financialStress" min="0" max="100" value="30" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>No Stress</span>
                        <span>High Stress</span>
                    </div>
                </div>

                <!-- Employment -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Weekly Work Hours</span>
                        <span class="slider-value" id="workHoursValue">10</span>
                    </div>
                    <input type="range" id="workHours" name="workHours" min="0" max="40" value="10" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>0 hours</span>
                        <span>40+ hours</span>
                    </div>
                </div>

                <!-- Family Support -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Family Support Level</span>
                        <span class="slider-value" id="familySupportValue">70%</span>
                    </div>
                    <input type="range" id="familySupport" name="familySupport" min="0" max="100" value="70" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>No Support</span>
                        <span>Very Supportive</span>
                    </div>
                </div>

                <!-- Health -->
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Health Status</span>
                        <span class="slider-value" id="healthStatusValue">80%</span>
                    </div>
                    <input type="range" id="healthStatus" name="healthStatus" min="0" max="100" value="80" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>Poor</span>
                        <span>Excellent</span>
                    </div>
                </div>
            </div>

            <!-- Risk Assessment Results -->
            <div class="section bg-blue-50 border border-blue-100">
                <h2 class="section-title text-blue-700">Risk Assessment</h2>
                <div class="text-center py-4">
                    <div class="text-4xl font-bold text-blue-600 mb-2" id="riskScore">0%</div>
                    <div class="text-lg font-medium" id="riskLevel">-</div>
                    <div class="mt-4 text-gray-600" id="riskFeedback">
                        Please complete all sections to see the risk assessment.
                    </div>
                </div>
            </div>

            <!-- Dashboard Link (shown after assessment completion) -->
            <div id="dashboardLinkContainer" class="hidden">
                <div class="mt-4 text-center">
                    <div class="alert alert-success">
                        <h5 class="alert-heading">ðŸŽ‰ Assessment Complete!</h5>
                        <p class="mb-2">Your dropout risk assessment has been saved and is now available in your dashboard.</p>
                        <p class="mb-3">View your personalized dashboard to see detailed analysis, recommendations, and track your progress over time.</p>
                        <a href="/dashboard/?user_id=${userId}" class="btn btn-success btn-lg">
                            <i class="fas fa-tachometer-alt me-2"></i>View My Dashboard
                        </a>
                    </div>
                </div>
            </div>

            <div class="flex justify-center">
                <button type="submit" class="btn-hover w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200 flex items-center justify-center">
                    <i class="fas fa-calculator mr-2"></i>
                    <span>Predict Dropout Risk</span>
                </button>
            </div>
        </form>
    </div>
        
        <!-- Performance Trends Tab -->
        <div id="performance-trends" class="tab-content hidden chart-container">
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">Performance Trends</h2>
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-700">Last 6 Months Overview</h3>
                        <div class="flex space-x-2">
                            <button id="trends-refresh" class="px-3 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200">
                                <i class="fas fa-sync-alt mr-1"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div id="trends-chart" class="h-80">
                        <div class="flex items-center justify-center h-full text-gray-500">
                            <p>Loading trends data...</p>
                        </div>
                    </div>
                    <div class="mt-4 text-sm text-gray-500">
                        <p>Hover over data points to see detailed information. Data updates after each risk assessment.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Category Progress Tab -->
        <div id="category-progress" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">Category Progress</h2>
                <div id="progress-container" class="space-y-6">
                    <!-- Progress bars will be inserted here by JavaScript -->
                    <div class="text-center text-gray-500">
                        <p>Complete a risk assessment to see your progress across different categories.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Goals Management Tab -->
        <div id="goals-management" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Goals Management</h2>
                    <button id="add-goal-btn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center" onclick="openGoalModal()">
                        <i class="fas fa-plus mr-2"></i> Add Goal
                    </button>
                </div>
                
                <div id="goals-container" class="space-y-4">
                    <!-- Goals will be dynamically inserted here -->
                </div>
                
                <div id="no-goals" class="text-center py-10 text-gray-400">
                    <i class="fas fa-bullseye text-4xl mb-2"></i>
                    <p>No goals set yet. Click 'Add Goal' to get started.</p>
                </div>
            </div>
        </div>

        <!-- Goal Modal -->
        <div id="goal-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
            <div class="bg-white rounded-lg p-6 w-full max-w-md">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800" id="modal-title">Add New Goal</h3>
                    <button onclick="closeGoalModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="goal-form" onsubmit="saveGoal(event)">
                    <input type="hidden" id="goal-id">
                    <div class="mb-4">
                        <label for="goal-title" class="block text-sm font-medium text-gray-700 mb-1">Goal Title</label>
                        <input type="text" id="goal-title" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="current-progress" class="block text-sm font-medium text-gray-700 mb-1">Current Progress (%)</label>
                            <input type="number" id="current-progress" min="0" max="100" value="0" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="target-progress" class="block text-sm font-medium text-gray-700 mb-1">Target (%)</label>
                            <input type="number" id="target-progress" min="1" max="100" value="100" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="closeGoalModal()" 
                                class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                            Cancel
                        </button>
                        <button type="submit" 
                                class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            Save Goal
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Resource Library Tab -->
        <div id="resource-library" class="tab-content hidden chart-container">
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">Resource Library</h2>
                <div class="space-y-6">
                    <!-- Academic Resources -->
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <div class="bg-blue-50 px-4 py-3 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-blue-800">
                                <i class="fas fa-graduation-cap mr-2"></i>Academic Resources
                            </h3>
                        </div>
                        <div class="p-4 grid gap-4 md:grid-cols-2">
                            <a href="https://www.khanacademy.org/" target="_blank" class="block p-4 border border-gray-200 rounded-lg hover:border-blue-400 hover:shadow-md transition-all duration-200">
                                <h4 class="font-medium text-blue-700">Khan Academy</h4>
                                <p class="text-sm text-gray-600 mt-1">Free online courses, lessons & practice</p>
                            </a>
                            <a href="https://ocw.mit.edu/" target="_blank" class="block p-4 border border-gray-200 rounded-lg hover:border-blue-400 hover:shadow-md transition-all duration-200">
                                <h4 class="font-medium text-blue-700">MIT OpenCourseWare</h4>
                                <p class="text-sm text-gray-600 mt-1">Free online course materials from MIT</p>
                            </a>
                        </div>
                    </div>

                    <!-- Study Skills -->
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <div class="bg-green-50 px-4 py-3 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-green-800">
                                <i class="fas fa-book-open mr-2"></i>Study Skills
                            </h3>
                        </div>
                        <div class="p-4 grid gap-4 md:grid-cols-2">
                            <a href="https://learningcenter.unc.edu/tips-and-tools/studying-101-study-smarter-not-harder/" target="_blank" class="block p-4 border border-gray-200 rounded-lg hover:border-green-400 hover:shadow-md transition-all duration-200">
                                <h4 class="font-medium text-green-700">Study Smarter, Not Harder</h4>
                                <p class="text-sm text-gray-600 mt-1">Effective study techniques from UNC</p>
                            </a>
                            <a href="https://www.cornell.edu/student-life/learning/" target="_blank" class="block p-4 border border-gray-200 rounded-lg hover:border-green-400 hover:shadow-md transition-all duration-200">
                                <h4 class="font-medium text-green-700">Cornell Learning Strategies</h4>
                                <p class="text-sm text-gray-600 mt-1">Academic support resources</p>
                            </a>
                        </div>
                    </div>

                    <!-- Mental Health -->
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <div class="bg-purple-50 px-4 py-3 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-purple-800">
                                <i class="fas fa-heart mr-2"></i>Mental Health & Wellness
                            </h3>
                        </div>
                        <div class="p-4 grid gap-4 md:grid-cols-2">
                            <a href="https://www.mentalhealth.gov/" target="_blank" class="block p-4 border border-gray-200 rounded-lg hover:border-purple-400 hover:shadow-md transition-all duration-200">
                                <h4 class="font-medium text-purple-700">MentalHealth.gov</h4>
                                <p class="text-sm text-gray-600 mt-1">U.S. government mental health resources</p>
                            </a>
                            <a href="https://www.ulifeline.org/" target="_blank" class="block p-4 border border-gray-200 rounded-lg hover:border-purple-400 hover:shadow-md transition-all duration-200">
                                <h4 class="font-medium text-purple-700">ULifeline</h4>
                                <p class="text-sm text-gray-600 mt-1">Online resource for college mental health</p>
                            </a>
                        </div>
                    </div>

                    <!-- Career Development -->
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <div class="bg-amber-50 px-4 py-3 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-amber-800">
                                <i class="fas fa-briefcase mr-2"></i>Career Development
                            </h3>
                        </div>
                        <div class="p-4 grid gap-4 md:grid-cols-2">
                            <a href="https://www.linkedin.com/learning/" target="_blank" class="block p-4 border border-gray-200 rounded-lg hover:border-amber-400 hover:shadow-md transition-all duration-200">
                                <h4 class="font-medium text-amber-700">LinkedIn Learning</h4>
                                <p class="text-sm text-gray-600 mt-1">Professional development courses</p>
                            </a>
                            <a href="https://www.indeed.com/career-advice" target="_blank" class="block p-4 border border-gray-200 rounded-lg hover:border-amber-400 hover:shadow-md transition-all duration-200">
                                <h4 class="font-medium text-amber-700">Indeed Career Guide</h4>
                                <p class="text-sm text-gray-600 mt-1">Career advice and job search tips</p>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quick Actions Dashboard -->
        <div id="quick-actions" class="tab-content hidden chart-container">
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">Quick Actions Dashboard</h2>
                
                <!-- Quick Stats -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-blue-700">Active Goals</p>
                                <p id="active-goals-count" class="text-2xl font-bold text-blue-900">0</p>
                            </div>
                            <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                                <i class="fas fa-bullseye text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-green-700">Upcoming Reminders</p>
                                <p id="upcoming-reminders-count" class="text-2xl font-bold text-green-900">0</p>
                            </div>
                            <div class="p-3 rounded-full bg-green-100 text-green-600">
                                <i class="fas fa-bell text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-purple-50 p-4 rounded-lg border border-purple-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-purple-700">Recent Activities</p>
                                <p id="recent-activities-count" class="text-2xl font-bold text-purple-900">0</p>
                            </div>
                            <div class="p-3 rounded-full bg-purple-100 text-purple-600">
                                <i class="fas fa-history text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Action Buttons -->
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-8">
                    <button onclick="document.getElementById('tab-risk').click()" class="flex flex-col items-center justify-center p-4 bg-white border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-200 transition-all duration-200">
                        <div class="p-3 rounded-full bg-blue-100 text-blue-600 mb-2">
                            <i class="fas fa-shield-alt text-xl"></i>
                        </div>
                        <span class="font-medium text-gray-700">Quick Assessment</span>
                    </button>
                    
                    <button onclick="openGoalModal()" class="flex flex-col items-center justify-center p-4 bg-white border border-gray-200 rounded-lg hover:bg-green-50 hover:border-green-200 transition-all duration-200">
                        <div class="p-3 rounded-full bg-green-100 text-green-600 mb-2">
                            <i class="fas fa-plus-circle text-xl"></i>
                        </div>
                        <span class="font-medium text-gray-700">Add Goal</span>
                    </button>
                    
                    <button onclick="openReminderModal()" class="flex flex-col items-center justify-center p-4 bg-white border border-gray-200 rounded-lg hover:bg-yellow-50 hover:border-yellow-200 transition-all duration-200">
                        <div class="p-3 rounded-full bg-yellow-100 text-yellow-600 mb-2">
                            <i class="fas fa-bell text-xl"></i>
                        </div>
                        <span class="font-medium text-gray-700">Set Reminder</span>
                    </button>
                    
                    <button onclick="document.getElementById('tab-progress').click()" class="flex flex-col items-center justify-center p-4 bg-white border border-gray-200 rounded-lg hover:bg-purple-50 hover:border-purple-200 transition-all duration-200">
                        <div class="p-3 rounded-full bg-purple-100 text-purple-600 mb-2">
                            <i class="fas fa-chart-line text-xl"></i>
                        </div>
                        <span class="font-medium text-gray-700">View Progress</span>
                    </button>
                    
                    <button onclick="openNoteModal()" class="flex flex-col items-center justify-center p-4 bg-white border border-gray-200 rounded-lg hover:bg-indigo-50 hover:border-indigo-200 transition-all duration-200">
                        <div class="p-3 rounded-full bg-indigo-100 text-indigo-600 mb-2">
                            <i class="fas fa-edit text-xl"></i>
                        </div>
                        <span class="font-medium text-gray-700">Add Note</span>
                    </button>
                    
                    <button onclick="document.getElementById('tab-resource-library').click()" class="flex flex-col items-center justify-center p-4 bg-white border border-gray-200 rounded-lg hover:bg-pink-50 hover:border-pink-200 transition-all duration-200">
                        <div class="p-3 rounded-full bg-pink-100 text-pink-600 mb-2">
                            <i class="fas fa-book text-xl"></i>
                        </div>
                        <span class="font-medium text-gray-700">View Resources</span>
                    </button>
                </div>
                
                <!-- Recent Activities -->
                <div class="bg-white border border-gray-200 rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Recent Activities</h3>
                    <div id="recent-activities" class="space-y-3">
                        <div class="text-center py-4 text-gray-500">
                            <p>No recent activities yet</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Reminders & Alerts Tab -->
        <div id="reminders" class="tab-content hidden chart-container">
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Reminders & Alerts</h2>
                    <button onclick="openReminderModal()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center">
                        <i class="fas fa-plus mr-2"></i> Add Reminder
                    </button>
                </div>
                
                <div id="reminders-list" class="space-y-4">
                    <!-- Reminders will be loaded here -->
                </div>
                
                <div id="no-reminders" class="text-center py-8 text-gray-500">
                    <i class="fas fa-bell-slash text-4xl mb-2"></i>
                    <p>No reminders set yet. Click 'Add Reminder' to create one.</p>
                </div>
            </div>
        </div>
        
        <!-- Notes & Observations Tab -->
        <div id="notes" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Notes & Observations</h2>
                    <button onclick="openNoteModal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center">
                        <i class="fas fa-plus mr-2"></i> Add Note
                    </button>
                </div>
                
                <div id="notes-container" class="space-y-4 max-h-[500px] overflow-y-auto pr-2">
                    <!-- Notes will be dynamically inserted here -->
                </div>
                
                <div id="no-notes" class="text-center py-10 text-gray-400">
                    <i class="fas fa-clipboard text-4xl mb-2"></i>
                    <p>No notes yet. Click 'Add Note' to create your first note.</p>
                </div>
            </div>
        </div>
        
        <!-- Note Modal -->
        <div id="note-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
            <div class="bg-white rounded-lg p-6 w-full max-w-md">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800" id="note-modal-title">Add New Note</h3>
                    <button onclick="closeNoteModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="note-form" onsubmit="saveNote(event)">
                    <input type="hidden" id="note-id">
                    <div class="mb-4">
                        <label for="note-title" class="block text-sm font-medium text-gray-700 mb-1">Title (Optional)</label>
                        <input type="text" id="note-title" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-3">
                        <label for="note-content" class="block text-sm font-medium text-gray-700 mb-1">Note</label>
                        <textarea id="note-content" required rows="4"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="closeNoteModal()" 
                                class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                            Cancel
                        </button>
                        <button type="submit" 
                                class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            Save Note
                        </button>
                    </div>
                </form>
            </div>
        </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-12">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
            <div class="md:flex md:items-center md:justify-between">
                <div class="flex justify-center md:justify-start space-x-6">
                    <a href="#" class="text-gray-400 hover:text-gray-500">
                        <span class="sr-only">About</span>
                        <span>About</span>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-gray-500">
                        <span class="sr-only">Privacy</span>
                        <span>Privacy</span>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-gray-500">
                        <span class="sr-only">Terms</span>
                        <span>Terms</span>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-gray-500">
                        <span class="sr-only">Contact</span>
                        <span>Contact</span>
                    </a>
                </div>
                <div class="mt-8 md:mt-0 text-center md:text-right">
                    <p class="text-sm text-gray-500">
                        &copy; 2023 AI in Education. All rights reserved.
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl">
            <div class="flex items-center">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mr-3"></div>
                <span class="text-gray-700">Processing...</span>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        // Immediately detect and store user_id from URL parameters
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            const urlUserId = urlParams.get('user_id');
            if (urlUserId) {
                localStorage.setItem('dashboard_user_id', urlUserId);
                console.log('Immediately stored user_id from URL:', urlUserId);
            }
        })();
        // Activity tracking function
        function trackActivity(type, title, data = {}) {
            const userId = localStorage.getItem('dashboard_user_id') || 'anonymous_' + Date.now();
            fetch('/api/dashboard/activity', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    user_id: userId,
                    type: type,
                    title: title,
                    description: title,
                    icon: 'fas fa-exclamation-triangle',
                    data: data,
                    page: 'dropout-risk',
                    action: 'visit'
                })
            });
        }

        // Toggle sidebar on mobile
        document.addEventListener('DOMContentLoaded', function() {
            // Debug: Check URL parameters immediately
            console.log('Page loaded - checking URL parameters...');
            const urlParams = new URLSearchParams(window.location.search);
            const urlUserId = urlParams.get('user_id');
            console.log('URL user_id parameter:', urlUserId);
            console.log('Current localStorage user_id:', localStorage.getItem('dashboard_user_id'));
            
            // Check for user_id in URL parameters and store it
            if (urlUserId) {
                localStorage.setItem('dashboard_user_id', urlUserId);
                console.log('Stored user_id from URL:', urlUserId);
            } else {
                console.log('No user_id found in URL');
            }
            
            // Track page visit
            trackActivity('page_visit', 'Visited Dropout Risk Assessment', {
                page: 'dropout-risk',
                timestamp: new Date().toISOString()
            });
            
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const sidebar = document.getElementById('sidebar');
            const collapseButton = document.getElementById('collapse-sidebar');
            
            if (mobileMenuButton) {
                mobileMenuButton.addEventListener('click', function() {
                    sidebar.classList.toggle('expanded');
                });
            }
            
            if (collapseButton) {
                collapseButton.addEventListener('click', function() {
                    sidebar.classList.remove('expanded');
                });
            }
            
            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', function(event) {
                const isClickInside = sidebar.contains(event.target) || 
                                    (mobileMenuButton && mobileMenuButton.contains(event.target));
                
                if (!isClickInside && window.innerWidth < 768) {
                    sidebar.classList.remove('expanded');
                }
            });
            
            // Initialize first tab as active
            document.querySelector('.tab-button').classList.add('active');
            document.querySelector('.tab-content').classList.add('active');
            
            // Show a welcome notification
            setTimeout(() => {
                showNotification('Welcome to Dropout Risk Analysis', 'Start analyzing student data to identify potential dropout risks.', 'info');
            }, 1000);
        });
        
        // Tab Navigation
        function switchTab(tabId) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
                content.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active', 'border-b-2', 'border-blue-600', 'text-blue-700');
                btn.classList.add('text-gray-600', 'hover:text-gray-800');
            });
            
            // Show selected tab content
            const activeTab = document.getElementById(tabId);
            if (activeTab) {
                activeTab.classList.remove('hidden');
                activeTab.classList.add('active');
                
                // Update URL hash without page reload
                if (history.pushState) {
                    const newUrl = window.location.pathname + '#' + tabId;
                    window.history.pushState({ path: newUrl }, '', newUrl);
                } else {
                    window.location.hash = tabId;
                }
                
                // Update active button
                const activeButton = document.querySelector(`[data-tab="${tabId}"]`);
                if (activeButton) {
                    activeButton.classList.add('active', 'border-b-2', 'border-blue-600', 'text-blue-700');
                    activeButton.classList.remove('text-gray-600', 'hover:text-gray-800');
                }
                
                // Load tab-specific content if needed
                if (tabId === 'performance-trends') {
                    loadTrendsData();
                } else if (tabId === 'category-progress') {
                    loadProgressData();
                }
            }
        }
        
        // Request notification permission on page load
        if ('Notification' in window) {
            Notification.requestPermission().then(permission => {
                console.log('Notification permission status:', permission);
            });
        }
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize tab click handlers
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabId = this.getAttribute('data-tab');
                    if (tabId) {
                        switchTab(tabId);
                    }
                });
            });

            // Handle browser back/forward buttons
            window.addEventListener('popstate', function() {
                const hash = window.location.hash.substring(1);
                if (hash) {
                    switchTab(hash);
                }
            });

            // Activate the initial tab
            const hash = window.location.hash.substring(1);
            const validTabs = ['risk-assessment', 'performance-trends', 'category-progress', 'goals-management', 'notes'];
            const defaultTab = 'risk-assessment';
            
            if (hash && validTabs.includes(hash)) {
                switchTab(hash);
            } else {
                switchTab(defaultTab);
            }
        });
        
        // Load trends data
        function loadTrendsData() {
            const chartContainer = document.getElementById('trends-chart');
            
            // Show loading state
            chartContainer.innerHTML = '<div class="flex items-center justify-center h-full"><div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div></div>';
            
            // Fetch data from the API
            // Ensure we're using the correct base URL
            const baseUrl = window.location.origin;
            fetch(`${baseUrl}/api/dropout-risk/trends/current-student`)
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(err => {
                            console.error('Error response:', err);
                            throw new Error(err.detail || `HTTP error! status: ${response.status}`);
                        }).catch(() => {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Trends data received:', data);
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    
                    // Check if we have valid data to render
                    if (!data || !data.dates || !data.dates.length) {
                        throw new Error('No trend data available');
                    }
                    
                    renderTrendsChart(data);
                })
                .catch(error => {
                    console.error('Error loading trends data:', error);
                    chartContainer.innerHTML = `
                        <div class="text-center p-8 text-gray-500">
                            <i class="fas fa-chart-line text-4xl mb-2"></i>
                            <p>${error.message || 'No trend data available'}</p>
                            <p class="text-sm mt-2">Complete a risk assessment to see performance trends</p>
                        </div>`;
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'text-yellow-600 bg-yellow-50 p-2 rounded text-sm mb-2';
                    errorDiv.innerHTML = 'Using sample data. ' + error.message;
                    chartContainer.prepend(errorDiv);
                });
        }
        
        // Render trends chart
        function renderTrendsChart(data) {
            const chartContainer = document.getElementById('trends-chart');
            
            // Ensure we have valid data
            if (!data || !data.dates || !data.dates.length) {
                chartContainer.innerHTML = `
                    <div class="text-center p-8 text-gray-500">
                        <i class="fas fa-chart-line text-4xl mb-2"></i>
                        <p>No trend data available</p>
                        <p class="text-sm mt-2">Complete a risk assessment to see performance trends</p>
                    </div>`;
                return;
            }
            
            // Clear any existing content
            chartContainer.innerHTML = '';
            
            // Create a container for the chart
            const chartDiv = document.createElement('div');
            chartDiv.style.width = '100%';
            chartDiv.style.height = '400px';
            chartContainer.appendChild(chartDiv);
            
            const traces = [
                {
                    x: data.dates || [],
                    y: data.grades || [],
                    name: 'Grades',
                    line: {color: '#3B82F6', width: 3},
                    mode: 'lines+markers',
                    marker: {size: 8}
                },
                {
                    x: data.dates || [],
                    y: data.attendance || [],
                    name: 'Attendance',
                    line: {color: '#10B981', width: 3},
                    mode: 'lines+markers',
                    marker: {size: 8}
                },
                {
                    x: data.dates || [],
                    y: data.assignments || [],
                    name: 'Assignments',
                    line: {color: '#8B5CF6', width: 3},
                    mode: 'lines+markers',
                    marker: {size: 8}
                },
                {
                    x: data.dates || [],
                    y: data.participation || [],
                    name: 'Participation',
                    line: {color: '#F59E0B', width: 3},
                    mode: 'lines+markers',
                    marker: {size: 8}
                }
            ];
            
            const layout = {
                title: 'Performance Trends (Last 6 Months)',
                xaxis: {title: 'Month'},
                yaxis: {title: 'Score (%)', range: [0, 100]},
                hovermode: 'closest',
                margin: {t: 30, b: 50, l: 50, r: 30},
                legend: {orientation: 'h', y: -0.2},
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: {family: 'Inter, system-ui, sans-serif'}
            };
            
            try {
                Plotly.newPlot(chartDiv, traces, layout, {responsive: true});
            } catch (error) {
                console.error('Error rendering chart:', error);
                chartContainer.innerHTML = `
                    <div class="text-center p-8 text-red-500">
                        <i class="fas fa-exclamation-triangle text-4xl mb-2"></i>
                        <p>Error rendering chart</p>
                        <p class="text-sm mt-2">${error.message || 'Please try again later'}</p>
                    </div>`;
            }
        }
        
        // Load progress data
        function loadProgressData() {
            // Ensure we're using the correct base URL
            const baseUrl = window.location.origin;
            fetch(`${baseUrl}/api/dropout-risk/progress`)
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(err => {
                            console.error('Error response:', err);
                            throw new Error(err.detail || `HTTP error! status: ${response.status}`);
                        }).catch(() => {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Progress data received:', data);
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    if (Object.keys(data).length === 0) {
                        throw new Error('No progress data available');
                    }
                    renderProgressBars(data);
                })
                .catch(error => {
                    console.error('Error loading progress data:', error);
                    const errorMessage = error.message.includes('No progress data') ? 
                        'Please complete a risk assessment first.' : 
                        'Error loading progress data. Please try again.';
                    
                    document.getElementById('progress-container').innerHTML = `
                        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                            <div class="flex">
                                <div class="flex-shrink-0">
                                    <svg class="h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-yellow-700">
                                        ${errorMessage}
                                    </p>
                                </div>
                            </div>
                        </div>`;
                });
        }
        
        // Render progress bars
        function renderProgressBars(data) {
            const container = document.getElementById('progress-container');
            if (Object.keys(data).length === 0) {
                container.innerHTML = `
                    <div class="text-center py-10 text-gray-400">
                        <i class="fas fa-chart-pie text-4xl mb-2"></i>
                        <p>Complete a risk assessment to view category progress</p>
                    </div>`;
                return;
            }
            
            let html = '';
            
            // Color mapping for different categories
            const colorMap = {
                'academic': '#3b82f6',
                'behavioral': '#8b5cf6',
                'personal': '#ec4899',
                'institutional': '#f59e0b',
                'social': '#10b981',
                'external': '#ef4444',
                'psychological': '#06b6d4',
                'historical': '#f97316',
                'digital': '#a855f7',
                'warning': '#f43f5e'
            };
            
            // Prepare data for progress bars
            for (const [category, info] of Object.entries(data)) {
                const score = Math.round(info.score);
                const percentage = Math.min(100, Math.max(0, score));
                const target = info.target || 100;
                const progress = Math.min(100, (score / target) * 100);
                
                let statusClass = 'bg-red-500';
                let statusText = 'Needs Improvement';
                
                if (score >= target) {
                    statusClass = 'bg-green-600';
                    statusText = 'Target Met';
                } else if (score >= target * 0.8) {
                    statusClass = 'bg-yellow-500';
                    statusText = 'Approaching Target';
                }
                
                const categoryName = category.charAt(0).toUpperCase() + category.slice(1).replace(/([A-Z])/g, ' $1');
                
                // Add progress bar HTML
                html += `
                <div class="bg-white p-4 rounded-lg shadow">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="font-medium text-gray-800">${categoryName}</h3>
                        <span class="text-sm px-2 py-1 rounded-full ${statusClass === 'bg-green-600' ? 'bg-green-100 text-green-800' : statusClass === 'bg-yellow-500' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">
                            ${statusText}
                        </span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5 mb-1">
                        <div class="h-2.5 rounded-full ${statusClass}" style="width: ${progress}%"></div>
                    </div>
                    <div class="flex justify-between text-sm text-gray-600">
                        <span>${score}%</span>
                        <span>Target: ${target}%</span>
                    </div>
                </div>`;
            }
            
            container.innerHTML = html;
        }
        
        // Update slider value displays
        document.querySelectorAll('input[type="range"]').forEach(slider => {
            const valueDisplay = document.getElementById(`${slider.id}Value`);
            const nonPercentageFields = [
                'grades', 'courseLoad', 'facultyInteraction', 'campusInvolvement',
                'commuteTime', 'familyResponsibilities', 'lmsActivity', 'schoolChanges'
            ];
            const isPercentage = !nonPercentageFields.includes(slider.id);
            valueDisplay.textContent = slider.value + (isPercentage ? '%' : '');
            
            slider.addEventListener('input', function() {
                valueDisplay.textContent = this.value + (isPercentage ? '%' : '');
                calculateRisk();
            });
        });

        function calculateRisk() {
            const data = getFormData();
            
            // Academic Performance (25% weight)
            const academicScore = (
                (data.grades * 0.3) + 
                (data.attendance * 0.2) + 
                (data.assignments * 0.2) + 
                (data.exams * 0.3)
            );
            
            // Behavioral Indicators (15% weight)
            const behavioralScore = (
                (data.participation * 0.4) + 
                ((100 - data.absences * 5) * 0.2) + 
                ((100 - data.tardiness * 5) * 0.2) + 
                ((100 - data.behavioralIssues * 5) * 0.2)
            );
            
            // Personal Factors (10% weight)
            const personalScore = (
                ((100 - data.financialStress) * 0.4) + 
                ((100 - data.workHours * 1.5) * 0.2) + 
                (data.familySupport * 0.2) + 
                (data.healthStatus * 0.2)
            );
            
            // Institutional Factors (10% weight)
            const institutionalScore = (
                ((100 - (data.courseLoad / 24 * 100)) * 0.3) + // Higher course load = higher risk
                (data.majorFit * 0.4) + // Better fit = lower risk
                (data.facultyInteraction * 5 * 0.2) + // More interaction = lower risk
                ((100 - (data.campusInvolvement * 2.5)) * 0.1) // More involvement = lower risk (but not too much)
            );
            
            // Social Factors (8% weight)
            const socialScore = (
                (data.peerNetwork * 0.4) + // Stronger network = lower risk
                (data.mentorship * 0.4) +  // Better mentorship = lower risk
                ((100 - data.bullying) * 0.2) // More bullying = higher risk
            );
            
            // External Factors (7% weight)
            const externalScore = (
                ((100 - (data.commuteTime / 180 * 100)) * 0.4) + // Longer commute = higher risk
                ((100 - (data.familyResponsibilities * 1.5)) * 0.3) + // More responsibilities = higher risk
                (data.workLifeBalance * 0.3) // Better balance = lower risk
            );

            // Psychological Factors (10% weight)
            const psychologicalScore = (
                (data.motivation * 0.4) + // Higher motivation = lower risk
                (data.selfEfficacy * 0.4) + // Higher self-efficacy = lower risk
                ((100 - data.stressLevel) * 0.2) // Higher stress = higher risk
            );

            // Historical Data (8% weight)
            const historicalScore = (
                ((100 - data.previousDropout) * 0.4) + // Previous dropout = higher risk
                ((100 - data.gradeRetention) * 0.4) +  // Grade retention = higher risk
                (Math.max(0, 100 - (data.schoolChanges * 10)) * 0.2) // More school changes = higher risk
            );

            // Digital Footprint (5% weight)
            const digitalScore = (
                (data.lmsActivity * 0.6) + // More LMS activity = lower risk
                (data.onlineEngagement * 0.4) // More online engagement = lower risk
            );

            // Early Warning Indicators (12% weight)
            const warningScore = (
                ((100 - data.warningSigns) * 0.7) + // More warning signs = higher risk
                ((100 - data.earlyAlerts) * 0.3)    // More faculty concerns = higher risk
            );
            
            // Weighted average of all factors (total = 100%)
            const riskScore = (
                (academicScore * 0.25) + 
                (behavioralScore * 0.15) + 
                (personalScore * 0.1) +
                (institutionalScore * 0.1) +
                (socialScore * 0.08) +
                (externalScore * 0.07) +
                (psychologicalScore * 0.1) +
                (historicalScore * 0.08) +
                (digitalScore * 0.05) +
                (warningScore * 0.12)
            );
            
            updateRiskDisplay(riskScore, {
                academic: academicScore,
                behavioral: behavioralScore,
                personal: personalScore,
                institutional: institutionalScore,
                social: socialScore,
                external: externalScore,
                psychological: psychologicalScore,
                historical: historicalScore,
                digital: digitalScore,
                warning: warningScore
            });
        }

        function updateRiskDisplay(score, categoryScores = {}) {
            const riskScoreElement = document.getElementById('riskScore');
            const riskLevelElement = document.getElementById('riskLevel');
            const riskDetailsElement = document.getElementById('riskDetails');
            const data = getFormData();
            
            // Update score
            riskScoreElement.textContent = score.toFixed(1);
            
            // Update risk level and color
            let riskLevel, bgColor, textColor;
            if (score >= 70) {
                riskLevel = 'High Risk';
                bgColor = 'bg-red-100';
                textColor = 'text-red-700';
            } else if (score >= 30) {
                riskLevel = 'Moderate Risk';
                bgColor = 'bg-yellow-100';
                textColor = 'text-yellow-700';
            } else {
                riskLevel = 'Low Risk';
                bgColor = 'bg-green-100';
                textColor = 'text-green-700';
            }
            
            riskLevelElement.textContent = riskLevel;
            riskLevelElement.className = `inline-block px-3 py-1 rounded-full text-sm font-semibold ${textColor} ${bgColor}`;
            
            // Helper function to create a risk meter
            const createRiskMeter = (value, color, label, max = 100) => {
                const percentage = Math.min(100, (value / max) * 100);
                return `
                    <div class="mb-2">
                        <div class="flex justify-between text-sm mb-1">
                            <span>${label}</span>
                            <span>${value.toFixed(1)}%</span>
                        </div>
                        <div class="h-2 bg-gray-200 rounded-full">
                            <div class="h-2 rounded-full ${color}" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            };
            
            // Update risk details with all categories
            riskDetailsElement.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4">
                    <!-- Academic Performance -->
                    <div class="p-4 bg-blue-50 rounded-lg">
                        <h3 class="font-semibold text-blue-700 mb-2">Academic Performance (30%)</h3>
                        ${createRiskMeter(categoryScores.academic || 0, 'bg-blue-500', 'Overall')}
                        <div class="text-sm text-gray-600 space-y-1 mt-2">
                            <div>GPA: ${data.grades.toFixed(1)}/10</div>
                            <div>Attendance: ${data.attendance}%</div>
                            <div>Assignments: ${data.assignments}%</div>
                            <div>Exams: ${data.exams}%</div>
                        </div>
                    </div>
                    
                    <!-- Behavioral Indicators -->
                    <div class="p-4 bg-orange-50 rounded-lg">
                        <h3 class="font-semibold text-orange-700 mb-2">Behavioral (20%)</h3>
                        ${createRiskMeter(categoryScores.behavioral || 0, 'bg-orange-500', 'Overall')}
                        <div class="text-sm text-gray-600 space-y-1 mt-2">
                            <div>Participation: ${data.participation}%</div>
                            <div>Absences: ${data.absences} days</div>
                            <div>Tardiness: ${data.tardiness} times</div>
                            <div>Behavioral Issues: ${data.behavioralIssues}</div>
                        </div>
                    </div>
                    
                    <!-- Personal Factors -->
                    <div class="p-4 bg-green-50 rounded-lg">
                        <h3 class="font-semibold text-green-700 mb-2">Personal (15%)</h3>
                        ${createRiskMeter(categoryScores.personal || 0, 'bg-green-500', 'Overall')}
                        <div class="text-sm text-gray-600 space-y-1 mt-2">
                            <div>Financial Stress: ${data.financialStress}%</div>
                            <div>Work Hours: ${data.workHours} hrs/wk</div>
                            <div>Family Support: ${data.familySupport}%</div>
                            <div>Health Status: ${data.healthStatus}%</div>
                        </div>
                    </div>
                    
                    <!-- Institutional Factors -->
                    <div class="p-4 bg-purple-50 rounded-lg">
                        <h3 class="font-semibold text-purple-700 mb-2">Institutional (15%)</h3>
                        ${createRiskMeter(categoryScores.institutional || 0, 'bg-purple-500', 'Overall')}
                        <div class="text-sm text-gray-600 space-y-1 mt-2">
                            <div>Course Load: ${data.courseLoad} credits</div>
                            <div>Major Fit: ${data.majorFit}%</div>
                            <div>Faculty Interaction: ${data.facultyInteraction} visits</div>
                            <div>Campus Involvement: ${data.campusInvolvement} hrs/wk</div>
                        </div>
                    </div>
                    
                    <!-- Social Factors -->
                    <div class="p-4 bg-yellow-50 rounded-lg">
                        <h3 class="font-semibold text-yellow-700 mb-2">Social (10%)</h3>
                        ${createRiskMeter(categoryScores.social || 0, 'bg-yellow-500', 'Overall')}
                        <div class="text-sm text-gray-600 space-y-1 mt-2">
                            <div>Peer Network: ${data.peerNetwork}%</div>
                            <div>Mentorship: ${data.mentorship}%</div>
                            <div>Bullying: ${data.bullying}%</div>
                        </div>
                    </div>
                    
                    <!-- External Factors -->
                    <div class="p-4 bg-indigo-50 rounded-lg">
                        <h3 class="font-semibold text-indigo-700 mb-2">External (10%)</h3>
                        ${createRiskMeter(categoryScores.external || 0, 'bg-indigo-500', 'Overall')}
                        <div class="text-sm text-gray-600 space-y-1 mt-2">
                            <div>Commute: ${data.commuteTime} min</div>
                            <div>Family Care: ${data.familyResponsibilities} hrs/wk</div>
                            <div>Work-Life Balance: ${data.workLifeBalance}%</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function getFormData() {
            return {
                // Academic Performance
                grades: parseFloat(document.getElementById('grades').value),
                attendance: parseFloat(document.getElementById('attendance').value),
                assignments: parseFloat(document.getElementById('assignments').value),
                exams: parseFloat(document.getElementById('exams').value),
                
                // Behavioral Indicators
                participation: parseFloat(document.getElementById('participation').value),
                absences: parseFloat(document.getElementById('absences').value),
                tardiness: parseFloat(document.getElementById('tardiness').value),
                behavioral_issues: parseFloat(document.getElementById('behavioralIssues').value),
                
                // Personal Factors
                financial_stress: parseFloat(document.getElementById('financialStress').value),
                work_hours: parseFloat(document.getElementById('workHours').value),
                family_support: parseFloat(document.getElementById('familySupport').value),
                health_status: parseFloat(document.getElementById('healthStatus').value),
                
                // Institutional Factors
                course_load: parseFloat(document.getElementById('courseLoad').value),
                major_fit: parseFloat(document.getElementById('majorFit').value),
                faculty_interaction: parseFloat(document.getElementById('facultyInteraction').value),
                campus_involvement: parseFloat(document.getElementById('campusInvolvement').value),
                
                // Social Factors
                peer_network: parseFloat(document.getElementById('peerNetwork').value),
                mentorship: parseFloat(document.getElementById('mentorship').value),
                bullying: parseFloat(document.getElementById('bullying').value),
                
                // External Factors
                commute_time: parseFloat(document.getElementById('commuteTime').value),
                family_responsibilities: parseFloat(document.getElementById('familyResponsibilities').value),
                work_life_balance: parseFloat(document.getElementById('workLifeBalance').value),
                
                // Psychological Factors
                motivation: parseFloat(document.getElementById('motivation').value),
                self_efficacy: parseFloat(document.getElementById('selfEfficacy').value),
                stress_level: parseFloat(document.getElementById('stressLevel').value),
                
                // Historical Data
                previous_dropout: parseFloat(document.getElementById('previousDropout').value),
                grade_retention: parseFloat(document.getElementById('gradeRetention').value),
                school_changes: parseFloat(document.getElementById('schoolChanges').value),
                
                // Digital Footprint
                lms_activity: parseFloat(document.getElementById('lmsActivity').value),
                online_engagement: parseFloat(document.getElementById('onlineEngagement').value),
                
                // Early Warning Indicators
                warning_signs: parseFloat(document.getElementById('warningSigns').value),
                early_alerts: parseFloat(document.getElementById('earlyAlerts').value)
            };
        }

        // Form submission
        document.getElementById('riskForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.querySelector('button[type="submit"]');
            const originalBtnText = submitBtn.innerHTML;
            const errorContainer = document.getElementById('errorContainer');
            
            try {
                // Clear previous errors
                if (errorContainer) {
                    errorContainer.innerHTML = '';
                    errorContainer.className = 'hidden';
                }
                
                // Show loading state
                submitBtn.disabled = true;
                submitBtn.innerHTML = 'Analyzing...';
                
                const formData = getFormData();
                
                // Add user_id to form data
                // FINAL FALLBACK: Force get user_id from URL parameters
                const urlParams = new URLSearchParams(window.location.search);
                const urlUserId = urlParams.get('user_id');
                
                let userId;
                if (urlUserId) {
                    // Force use the URL user_id - this is the most reliable source
                    userId = urlUserId;
                    console.log('FINAL FALLBACK: Using user_id from URL:', userId);
                } else {
                    // Only if no URL parameter, use localStorage or create new
                    userId = localStorage.getItem('dashboard_user_id');
                    console.log('No URL user_id, using localStorage:', userId);
                    
                    if (!userId) {
                        userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                        localStorage.setItem('dashboard_user_id', userId);
                        console.log('Created new user_id:', userId);
                    }
                }
                
                console.log('FINAL user_id being used:', userId);
                formData.user_id = userId;
                
                console.log('Sending form data:', formData);
                
                // Validate form data
                const requiredFields = [
                    'grades', 'attendance', 'assignments', 'exams',
                    'participation', 'absences', 'tardiness', 'behavioral_issues',
                    'financial_stress', 'work_hours', 'family_support', 'health_status',
                    'course_load', 'major_fit', 'faculty_interaction', 'campus_involvement',
                    'peer_network', 'mentorship', 'bullying', 'commute_time',
                    'family_responsibilities', 'work_life_balance', 'motivation',
                    'self_efficacy', 'stress_level', 'previous_dropout', 'grade_retention',
                    'school_changes', 'lms_activity', 'online_engagement', 'warning_signs',
                    'early_alerts'
                ];
                
                // Check for missing or invalid fields
                const missingFields = requiredFields.filter(field => {
                    return formData[field] === undefined || formData[field] === null || formData[field] === '';
                });
                
                if (missingFields.length > 0) {
                    throw new Error(`Missing required fields: ${missingFields.join(', ')}`);
                }
                
                // Send data to backend
                const baseUrl = window.location.origin;
                console.log('Sending request to:', `${baseUrl}/api/dropout-risk/assess`);
                const response = await fetch(`${baseUrl}/api/dropout-risk/assess`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                let result;
                try {
                    result = await response.json();
                } catch (jsonError) {
                    console.error('Failed to parse JSON response:', jsonError);
                    const text = await response.text();
                    console.error('Response text:', text);
                    throw new Error('Invalid response from server');
                }
                
                console.log('Server response:', response.status, result);
                
                if (!response.ok) {
                    const errorMessage = result.detail || 
                                      result.message || 
                                      (result.errors ? JSON.stringify(result.errors) : 'Failed to process assessment');
                    throw new Error(errorMessage);
                }
                
                // Update UI with results from server
                if (result.success) {
                    // Track assessment completion
                    trackActivity('dropout_assessment', 'Dropout Risk Assessment Completed', {
                        risk_level: result.risk_level,
                        risk_score: result.risk_score,
                        page: 'dropout-risk',
                        timestamp: new Date().toISOString()
                    });
                    
                    // Update risk display
                    updateRiskDisplay({
                        risk_score: result.risk_score,
                        risk_level: result.risk_level,
                        factors: result.factors
                    });
                    
                    // Show dashboard link
                    const dashboardLinkContainer = document.getElementById('dashboardLinkContainer');
                    if (dashboardLinkContainer) {
                        // Update the dashboard link with the correct user ID
                        const dashboardLink = dashboardLinkContainer.querySelector('a');
                        if (dashboardLink) {
                            dashboardLink.href = `/dashboard/?user_id=${userId}`;
                        }
                        dashboardLinkContainer.classList.remove('hidden');
                    }
                    
                    // Update progress data
                    if (result.progress) {
                        renderProgressBars(result.progress);
                    }
                    
                    // Refresh trends data if on the trends tab
                    if (document.querySelector('[data-tab="performance-trends"].active')) {
                        await loadTrendsData();
                    }
                    
                    // Show success message
                    const successMsg = document.createElement('div');
                    successMsg.className = 'mt-4 p-3 bg-green-100 text-green-700 rounded-md';
                    successMsg.innerHTML = 'Assessment saved successfully! View the Performance Trends tab for updated analytics.';
                    
                    // Insert success message after the form
                    const form = document.getElementById('riskForm');
                    if (form) {
                        // Remove any existing success messages
                        const existingMsgs = form.parentNode.querySelectorAll('.bg-green-100');
                        existingMsgs.forEach(msg => msg.remove());
                        
                        form.parentNode.insertBefore(successMsg, form.nextSibling);
                        
                        // Remove success message after 5 seconds
                        setTimeout(() => {
                            successMsg.remove();
                        }, 5000);
                    }
                    
                    // Force refresh the progress tab if it's active
                    if (document.querySelector('[data-tab="category-progress"].active')) {
                        await loadProgressData();
                    }
                } else {
                    throw new Error(result.error || 'Failed to process assessment');
                }
                
            } catch (error) {
                console.error('Form submission error:', error);
                // Ensure we're showing a string, not an object
                let errorMessage = 'An error occurred while processing your request';
                if (error instanceof Error) {
                    errorMessage = error.message || errorMessage;
                } else if (typeof error === 'string') {
                    errorMessage = error;
                } else if (error && typeof error.toString === 'function') {
                    errorMessage = error.toString();
                    errorContainer.scrollIntoView({ behavior: 'smooth' });
                } else {
                    alert(`Error: ${error.message}\n\nCheck the browser console for more details.`);
                }
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalBtnText;
            }
        });
        
        // Function to load assessment data for visualization
        async function loadTrendsData() {
            const trendsContainer = document.getElementById('trends-chart');
            if (!trendsContainer) return;
            
            // Show loading state
            trendsContainer.innerHTML = `
                <div class="flex items-center justify-center h-64">
                    <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
                    <span class="ml-3">Loading assessment data...</span>
                </div>`;
                
            try {
                // Get the latest assessment data
                // Ensure we're using the correct base URL
                const baseUrl = window.location.origin;
                const response = await fetch(`${baseUrl}/api/dropout-risk/trends/current-student`);
                if (!response.ok) {
                    const error = await response.json().catch(() => ({}));
                    console.error('Error fetching trends:', error);
                    throw new Error(error.detail || `Failed to load trends: ${response.status}`);
                }
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                if (data.message === 'Complete a risk assessment to see performance trends') {
                    trendsContainer.innerHTML = `
                        <div class="flex flex-col items-center justify-center h-64 text-gray-500">
                            <i class="fas fa-chart-line text-4xl mb-4"></i>
                            <p class="text-lg font-medium">No Assessment Data</p>
                            <p class="text-sm mt-2">Complete a risk assessment to see your performance metrics</p>
                        </div>`;
                    return;
                }
                
                // Update the chart with assessment data
                renderAssessmentMetrics(data);
                
            } catch (error) {
                console.error('Error loading assessment data:', error);
                trendsContainer.innerHTML = `
                    <div class="p-4 bg-red-50 text-red-700 rounded-md">
                        <p>Error loading assessment data. Please try again later.</p>
                        <p class="text-sm mt-1">${error.message}</p>
                    </div>`;
            }
        }
        
        // Function to render assessment metrics in a line graph
        function renderAssessmentMetrics(data) {
            const container = document.getElementById('trends-chart');
            if (!container) return;
            
            // Clear previous content
            container.innerHTML = '';
            
            // Create a container for the metrics
            const metricsContainer = document.createElement('div');
            metricsContainer.className = 'space-y-6';
            
            // Add risk score card with improved styling
            if (data.risk_score !== undefined) {
                const riskLevel = data.risk_level || 'Not Available';
                let riskColor = 'from-blue-50 to-blue-100 text-blue-800 border-blue-200';
                let riskIcon = 'info-circle';
                
                if (riskLevel.toLowerCase().includes('high')) {
                    riskColor = 'from-red-50 to-red-100 text-red-800 border-red-200';
                    riskIcon = 'exclamation-triangle';
                } else if (riskLevel.toLowerCase().includes('moderate')) {
                    riskColor = 'from-yellow-50 to-yellow-100 text-yellow-800 border-yellow-200';
                    riskIcon = 'exclamation-circle';
                }
                
                metricsContainer.innerHTML += `
                    <div class="bg-gradient-to-br ${riskColor} border rounded-xl p-6 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-xl font-semibold text-gray-900">Risk Assessment Summary</h3>
                                <p class="text-sm opacity-80">Based on latest assessment</p>
                            </div>
                            <div class="bg-white/50 p-3 rounded-full">
                                <i class="fas fa-${riskIcon} text-2xl"></i>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                            <div class="bg-white/50 p-4 rounded-lg border backdrop-blur-sm">
                                <p class="text-xs font-medium text-gray-500 uppercase tracking-wider">Risk Score</p>
                                <div class="flex items-end mt-1">
                                    <p class="text-3xl font-bold">${data.risk_score.toFixed(1)}</p>
                                    <span class="text-lg font-medium ml-1 mb-1">%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                    <div class="h-2 rounded-full ${riskColor.includes('red') ? 'bg-red-500' : riskColor.includes('yellow') ? 'bg-yellow-500' : 'bg-blue-500'}" 
                                         style="width: ${data.risk_score}%"></div>
                                </div>
                            </div>
                            
                            <div class="bg-white/50 p-4 rounded-lg border backdrop-blur-sm">
                                <p class="text-xs font-medium text-gray-500 uppercase tracking-wider">Risk Level</p>
                                <p class="text-xl font-semibold mt-1">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${riskColor.includes('red') ? 'bg-red-100 text-red-800' : riskColor.includes('yellow') ? 'bg-yellow-100 text-yellow-800' : 'bg-blue-100 text-blue-800'}">
                                        ${riskLevel}
                                    </span>
                                </p>
                                <p class="text-xs text-gray-500 mt-2">${getRiskDescription(data.risk_score)}</p>
                            </div>
                            
                            <div class="bg-white/50 p-4 rounded-lg border backdrop-blur-sm">
                                <p class="text-xs font-medium text-gray-500 uppercase tracking-wider">Assessment Date</p>
                                <p class="text-2xl font-bold mt-1">${new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</p>
                                <p class="text-xs text-gray-500 mt-2">${new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}</p>
                            </div>
                        </div>
                    </div>`;
            }
            
            // Create chart container with controls
            metricsContainer.innerHTML += `
                <div class="bg-white rounded-xl border border-gray-200 overflow-hidden shadow-sm">
                    <div class="p-5 border-b border-gray-100">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">Performance Metrics</h3>
                                <p class="text-sm text-gray-500 mt-1">Track your progress across different metrics</p>
                            </div>
                            <div class="mt-3 sm:mt-0 flex space-x-2">
                                <button class="px-3 py-1.5 text-xs font-medium rounded-md bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors" id="resetViewBtn">
                                    <i class="fas fa-sync-alt mr-1"></i> Reset View
                                </button>
                                <div class="relative group">
                                    <button class="px-3 py-1.5 text-xs font-medium rounded-md bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors" id="chartMenuBtn">
                                        <i class="fas fa-ellipsis-h"></i>
                                    </button>
                                    <div class="hidden absolute right-0 mt-1 w-48 bg-white rounded-md shadow-lg py-1 z-10 border border-gray-200" id="chartMenu">
                                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" id="exportPNG">Export as PNG</a>
                                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" id="exportPDF">Export as PDF</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Metric Filters -->
                        <div class="flex flex-wrap gap-2 mt-4" id="metricFilters">
                            <button class="metric-filter active px-3 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800 border border-blue-200" data-category="all">
                                All Metrics
                            </button>
                            <button class="metric-filter px-3 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-700 border border-gray-200 hover:bg-gray-200" data-category="academic">
                                Academic
                            </button>
                            <button class="metric-filter px-3 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-700 border border-gray-200 hover:bg-gray-200" data-category="behavioral">
                                Behavioral
                            </button>
                        </div>
                    </div>
                    
                    <!-- Chart Container -->
                    <div class="p-4">
                        <div class="relative h-96">
                            <canvas id="performanceChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Legend and Info -->
                    <div class="p-4 border-t border-gray-100 bg-gray-50">
                        <div class="flex flex-col space-y-2 text-xs text-gray-600">
                            <div class="flex items-start space-x-2">
                                <i class="fas fa-info-circle mt-0.5"></i>
                                <p class="leading-tight">Hover over data points to see detailed information. Data updates after each risk assessment.</p>
                            </div>
                            <div class="flex flex-wrap items-center justify-between pt-1">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-mouse-pointer"></i>
                                    <span>Click legend items to show/hide metrics</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-arrows-alt"></i>
                                    <span>Double-click to reset view</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`;
            
            // Add the metrics container to the DOM
            container.appendChild(metricsContainer);
            
            // Now create the chart
            createLineChart(data);
            
            // Setup event listeners for the chart controls
            setupChartControls();
        }
        
        // Helper function to get risk description
        function getRiskDescription(score) {
            if (score >= 70) return 'High risk of dropout';
            if (score >= 40) return 'Moderate risk of dropout';
            return 'Low risk of dropout';
        }
        
        // Function to setup chart controls
        function setupChartControls() {
            // Toggle chart menu
            const chartMenuBtn = document.getElementById('chartMenuBtn');
            const chartMenu = document.getElementById('chartMenu');
            
            if (chartMenuBtn && chartMenu) {
                chartMenuBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    chartMenu.classList.toggle('hidden');
                });
                
                // Close menu when clicking outside
                document.addEventListener('click', () => {
                    chartMenu.classList.add('hidden');
                });
                
                // Prevent menu from closing when clicking inside
                chartMenu.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
                
                // Export functionality
                document.getElementById('exportPNG')?.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (window.chart) {
                        const link = document.createElement('a');
                        link.download = 'performance-trends.png';
                        link.href = window.chart.toBase64Image('image/png');
                        link.click();
                    }
                });
                
                document.getElementById('exportPDF')?.addEventListener('click', (e) => {
                    e.preventDefault();
                    alert('PDF export would be implemented with a PDF library');
                });
            }
            
            // Reset view button
            document.getElementById('resetViewBtn')?.addEventListener('click', () => {
                if (window.chart) {
                    window.chart.resetZoom();
                }
            });
            
            // Metric filter buttons
            const metricFilters = document.querySelectorAll('.metric-filter');
            metricFilters.forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    const category = button.dataset.category;
                    
                    // Update active state
                    metricFilters.forEach(btn => btn.classList.remove('active', 'bg-blue-100', 'text-blue-800', 'border-blue-200'));
                    metricFilters.forEach(btn => {
                        if (btn.dataset.category === category) {
                            btn.classList.add('active', 'bg-blue-100', 'text-blue-800', 'border-blue-200');
                        } else {
                            btn.classList.add('bg-gray-100', 'text-gray-700', 'border-gray-200', 'hover:bg-gray-200');
                        }
                    });
                    
                    // Filter datasets based on category
                    if (window.chart) {
                        window.chart.data.datasets.forEach(dataset => {
                            const datasetCategory = getDatasetCategory(dataset.label);
                            if (category === 'all') {
                                dataset.hidden = false;
                            } else {
                                dataset.hidden = datasetCategory !== category;
                            }
                        });
                        window.chart.update();
                    }
                });
            });
        }
        
        // Helper function to categorize datasets
        function getDatasetCategory(datasetLabel) {
            const academicMetrics = ['Grades', 'Attendance', 'Assignments', 'Exams'];
            const behavioralMetrics = ['Behavioral Issues', 'Motivation', 'Self-Efficacy', 'Participation'];
            
            if (academicMetrics.includes(datasetLabel)) return 'academic';
            if (behavioralMetrics.includes(datasetLabel)) return 'behavioral';
            return 'other';
        }
        
        // Function to create a line chart with enhanced interactivity and styling
        function createLineChart(data) {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            
            // Define colors for each metric with hover states
            const colors = {
                grades: {
                    bg: 'rgba(59, 130, 246, 0.1)',
                    border: 'rgba(59, 130, 246, 0.8)',
                    hoverBg: 'rgba(59, 130, 246, 0.2)',
                    hoverBorder: 'rgba(59, 130, 246, 1)'
                },
                attendance: {
                    bg: 'rgba(16, 185, 129, 0.1)',
                    border: 'rgba(16, 185, 129, 0.8)',
                    hoverBg: 'rgba(16, 185, 129, 0.2)',
                    hoverBorder: 'rgba(16, 185, 129, 1)'
                },
                assignments: {
                    bg: 'rgba(245, 158, 11, 0.1)',
                    border: 'rgba(245, 158, 11, 0.8)',
                    hoverBg: 'rgba(245, 158, 11, 0.2)',
                    hoverBorder: 'rgba(245, 158, 11, 1)'
                },
                exams: {
                    bg: 'rgba(139, 92, 246, 0.1)',
                    border: 'rgba(139, 92, 246, 0.8)',
                    hoverBg: 'rgba(139, 92, 246, 0.2)',
                    hoverBorder: 'rgba(139, 92, 246, 1)'
                },
                participation: {
                    bg: 'rgba(20, 184, 166, 0.1)',
                    border: 'rgba(20, 184, 166, 0.8)',
                    hoverBg: 'rgba(20, 184, 166, 0.2)',
                    hoverBorder: 'rgba(20, 184, 166, 1)'
                },
                behavioral_issues: {
                    bg: 'rgba(239, 68, 68, 0.1)',
                    border: 'rgba(239, 68, 68, 0.8)',
                    hoverBg: 'rgba(239, 68, 68, 0.2)',
                    hoverBorder: 'rgba(239, 68, 68, 1)'
                },
                motivation: {
                    bg: 'rgba(249, 115, 22, 0.1)',
                    border: 'rgba(249, 115, 22, 0.8)',
                    hoverBg: 'rgba(249, 115, 22, 0.2)',
                    hoverBorder: 'rgba(249, 115, 22, 1)'
                },
                self_efficacy: {
                    bg: 'rgba(6, 182, 212, 0.1)',
                    border: 'rgba(6, 182, 212, 0.8)',
                    hoverBg: 'rgba(6, 182, 212, 0.2)',
                    hoverBorder: 'rgba(6, 182, 212, 1)'
                }
            };
            
            // Prepare datasets for the chart with enhanced styling
            const datasets = [
                createDataset('Grades', data.grades, colors.grades, 'fa-chart-line'),
                createDataset('Attendance', data.attendance, colors.attendance, 'fa-calendar-check'),
                createDataset('Assignments', data.assignments, colors.assignments, 'fa-tasks'),
                createDataset('Exams', data.exams, colors.exams, 'fa-file-alt'),
                createDataset('Participation', data.participation, colors.participation, 'fa-hand-paper'),
                createDataset('Behavioral Issues', data.behavioral_issues, colors.behavioral_issues, 'fa-exclamation-triangle', true),
                createDataset('Motivation', data.motivation, colors.motivation, 'fa-fire'),
                createDataset('Self-Efficacy', data.self_efficacy, colors.self_efficacy, 'fa-brain')
            ];

            // Create the chart with enhanced configuration
            window.chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.dates,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            align: 'start',
                            labels: {
                                usePointStyle: true,
                                padding: 16,
                                font: {
                                    family: 'Inter, system-ui, -apple-system, sans-serif',
                                    size: 12,
                                    weight: '500'
                                },
                                generateLabels: function(chart) {
                                    const data = chart.data;
                                    if (!data.labels.length && !data.datasets.length) return [];
                                    
                                    return data.datasets.map(function(dataset, i) {
                                        const meta = chart.getDatasetMeta(i);
                                        let style = meta.controller.getStyle(0);
                                        
                                        return {
                                            text: dataset.label,
                                            fillStyle: style.backgroundColor,
                                            strokeStyle: style.borderColor,
                                            lineWidth: 2,
                                            hidden: !chart.isDatasetVisible(i),
                                            lineCap: 'round',
                                            pointStyle: 'circle',
                                            rotation: 0
                                        };
                                    });
                                }
                            },
                            onClick: function(e, legendItem, legend) {
                                const index = legendItem.datasetIndex;
                                const ci = legend.chart;
                                const meta = ci.getDatasetMeta(index);
                                 
                                // Toggle visibility
                                meta.hidden = meta.hidden === null ? !ci.data.datasets[index].hidden : null;
                                 
                                // Update the chart
                                ci.update();
                                 
                                // Update the legend item style
                                legend.chart.update('none');
                            }
                        },
                        tooltip: {
                            enabled: true,
                            backgroundColor: 'rgba(255, 255, 255, 0.98)',
                            titleColor: '#111827',
                            titleFont: {
                                family: 'Inter, system-ui, -apple-system, sans-serif',
                                size: 13,
                                weight: '600'
                            },
                            bodyColor: '#4B5563',
                            bodyFont: {
                                family: 'Inter, system-ui, -apple-system, sans-serif',
                                size: 13,
                                weight: '500'
                            },
                            borderColor: 'rgba(209, 213, 219, 0.8)',
                            borderWidth: 1,
                            padding: 12,
                            cornerRadius: 8,
                            usePointStyle: true,
                            boxPadding: 6,
                            displayColors: true,
                            callbacks: {
                                title: function(context) {
                                    return context[0]?.label || '';
                                },
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = context.parsed.y;
                                    const icon = context.dataset.icon || 'circle';
                                    const isNegative = context.dataset.isNegative || false;
                                    
                                    // Add trend indicator
                                    let trend = '';
                                    if (context.dataIndex > 0) {
                                        const prevValue = context.dataset.data[context.dataIndex - 1];
                                        const diff = value - prevValue;
                                        if (Math.abs(diff) > 0.5) {
                                            const trendIcon = diff > 0 ? 'â†‘' : 'â†“';
                                            const trendClass = (diff > 0 && !isNegative) || (diff < 0 && isNegative) ? 'text-green-500' : 'text-red-500';
                                            trend = ` <span class="${trendClass} font-medium">${Math.abs(diff).toFixed(1)} ${trendIcon}</span>`;
                                        }
                                    }
                                    
                                    return ` ${label}: ${value.toFixed(1)}%${trend}`;
                                },
                                labelColor: function(context) {
                                    const color = context.dataset.borderColor || 'rgba(0, 0, 0, 0.1)';
                                    return {
                                        borderColor: color,
                                        backgroundColor: color,
                                        borderWidth: 2,
                                        borderRadius: 2,
                                    };
                                },
                                labelTextColor: function(context) {
                                    return context.dataset.textColor || '#374151';
                                },
                                footer: function(tooltipItems) {
                                    if (tooltipItems.length > 0) {
                                        const dataIndex = tooltipItems[0].dataIndex;
                                        if (dataIndex === data.dates.length - 1) {
                                            return 'Current Assessment';
                                        } else if (dataIndex === 0) {
                                            return '5 months ago';
                                        } else {
                                            return `${data.dates.length - 1 - dataIndex} month${data.dates.length - 1 - dataIndex > 1 ? 's' : ''} ago`;
                                        }
                                    }
                                    return '';
                                },
                                footerColor: function() {
                                    return '#6B7280';
                                },
                                footerFont: {
                                    style: 'italic',
                                    size: 11
                                }
                            },
                            position: 'nearest',
                            caretSize: 8,
                            caretPadding: 8,
                            bodySpacing: 6,
                            titleSpacing: 6,
                            titleMarginBottom: 6,
                            footerMarginTop: 4,
                            xPadding: 12,
                            yPadding: 12,
                        },
                        zoom: {
                            zoom: {
                                wheel: {
                                    enabled: true,
                                    speed: 0.1,
                                    sensitivity: 0.5
                                },
                                pinch: {
                                    enabled: true
                                },
                                mode: 'x',
                                onZoomComplete: function({ chart }) {
                                    // This prevents the chart from resetting the zoom level
                                    chart.update('none');
                                }
                            },
                            pan: {
                                enabled: true,
                                mode: 'x',
                                speed: 0.5,
                                threshold: 10
                            },
                            limits: {
                                x: { min: 0, max: data.dates.length - 1, minRange: 2 }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                color: '#6B7280',
                                font: {
                                    family: 'Inter, system-ui, -apple-system, sans-serif',
                                    size: 12
                                },
                                maxRotation: 0,
                                autoSkip: true,
                                maxTicksLimit: 6,
                                padding: 8,
                                callback: function(value, index, values) {
                                    // Only show every 2nd label if there are many points
                                    if (values.length > 8 && index % 2 !== 0) return '';
                                    return data.dates[index];
                                }
                            },
                            border: {
                                display: false
                            }
                        },
                        y: {
                            beginAtZero: true,
                            suggestedMin: 0,
                            suggestedMax: 100,
                            grid: {
                                color: 'rgba(229, 231, 235, 0.5)',
                                drawBorder: false,
                                drawTicks: false,
                                borderDash: [3, 3]
                            },
                            ticks: {
                                color: '#9CA3AF',
                                font: {
                                    family: 'Inter, system-ui, -apple-system, sans-serif',
                                    size: 11
                                },
                                padding: 8,
                                callback: function(value) {
                                    return value + '%';
                                },
                                maxTicksLimit: 6
                            },
                            border: {
                                display: false
                            }
                        }
                    },
                    animation: {
                        duration: 800,
                        easing: 'easeInOutQuart',
                        x: {
                            type: 'number',
                            easing: 'easeOutQuart',
                            duration: 150,
                            from: (ctx) => {
                                if (ctx.type === 'data' && ctx.mode === 'default' && !ctx.dropped) {
                                    ctx.dropped = true;
                                    return ctx.chart.scales.x.getPixelForValue(0) - 100;
                                }
                            },
                            to: (ctx) => {
                                return ctx.chart.scales.x.getPixelForValue(ctx.dataIndex);
                            }
                        },
                        y: {
                            type: 'number',
                            easing: 'easeOutQuart',
                            duration: 800,
                            from: (ctx) => {
                                if (ctx.type === 'data' && ctx.mode === 'default' && !ctx.dropped) {
                                    return ctx.chart.scales.y.getPixelForValue(0);
                                }
                                return ctx.chart.scales.y.getPixelForValue(ctx.raw);
                            },
                            to: (ctx) => {
                                return ctx.chart.scales.y.getPixelForValue(ctx.raw);
                            }
                        },
                        opacity: {
                            type: 'number',
                            easing: 'easeInOutQuart',
                            duration: 800,
                            from: 0,
                            to: 1,
                            delay: (ctx) => ctx.dataIndex * 50
                        }
                    },
                    transitions: {
                        active: {
                            animation: {
                                duration: 200
                            }
                        },
                        resize: {
                            animation: {
                                duration: 200
                            }
                        },
                        zoom: {
                            animation: {
                                duration: 300,
                                easing: 'easeOutCubic'
                            }
                        }
                    },
                    elements: {
                        line: {
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true,
                            borderJoinStyle: 'round',
                            borderCapStyle: 'round',
                            borderDash: []
                        },
                        point: {
                            radius: 0,
                            hoverRadius: 6,
                            hoverBorderWidth: 2,
                            hoverBackgroundColor: (context) => {
                                return context.dataset.borderColor;
                            },
                            hoverBorderColor: '#FFFFFF',
                            hitRadius: 10,
                            hoverHitRadius: 12
                        },
                        arc: {
                            borderWidth: 0
                        }
                    },
                    onHover: (event, chartElement) => {
                        const target = event.native?.target;
                        if (target) {
                            target.style.cursor = chartElement[0] ? 'pointer' : 'default';
                        }
                    },
                    onClick: (e, elements) => {
                        if (elements && elements.length > 0) {
                            const element = elements[0];
                            const dataset = window.chart.data.datasets[element.datasetIndex];
                            const value = dataset.data[element.index];
                            const label = window.chart.data.labels[element.index];
                             
                            // You can add custom click behavior here
                            console.log(`Clicked on ${dataset.label} at ${label}: ${value}%`);
                        }
                    },
                    onResize: (chart, size) => {
                        // Adjust font sizes based on container size
                        if (size.width < 500) {
                            chart.options.plugins.legend.labels.padding = 8;
                            chart.options.plugins.legend.labels.font.size = 10;
                        } else {
                            chart.options.plugins.legend.labels.padding = 16;
                            chart.options.plugins.legend.labels.font.size = 12;
                        }
                    }
                }
            });
            
            // Add double-click to reset zoom
            document.getElementById('performanceChart').onclick = function(evt) {
                if (evt.detail === 2) { // Double click
                    window.chart.resetZoom();
                }
            };
        }
        
        // Helper function to create consistent dataset configurations
        function createDataset(label, data, color, icon, isNegative = false) {
            return {
                label: label,
                data: data,
                borderColor: color.border,
                backgroundColor: color.bg,
                hoverBackgroundColor: color.hoverBg,
                hoverBorderColor: color.hoverBorder,
                borderWidth: 2,
                pointBackgroundColor: color.border,
                pointHoverBackgroundColor: color.hoverBorder,
                pointHoverBorderColor: '#FFFFFF',
                pointHoverBorderWidth: 2,
                pointRadius: 0,
                pointHoverRadius: 6,
                pointHitRadius: 10,
                pointHoverHitRadius: 12,
                borderJoinStyle: 'round',
                borderCapStyle: 'round',
                tension: 0.3,
                fill: false,
                icon: icon,
                isNegative: isNegative,
                textColor: isNegative ? '#EF4444' : '#1F2937',
                // Add custom properties for tooltips
                getMetricStatus: function(value, index, array) {
                    if (index === 0) return 'neutral';
                    const prevValue = array[index - 1];
                    const diff = value - prevValue;
                    if (Math.abs(diff) < 0.5) return 'neutral';
                    return (diff > 0 && !isNegative) || (diff < 0 && isNegative) ? 'positive' : 'negative';
                },
                // Add a method to get trend data
                getTrend: function() {
                    if (this.data.length < 2) return 0;
                    const first = this.data[0];
                    const last = this.data[this.data.length - 1];
                    return ((last - first) / first) * 100;
                }
            };
        }

        // Update risk display with server response
        function updateRiskDisplay(result) {
            const riskScore = result.risk_score;
            const riskLevel = result.risk_level;
            
            // Update risk score and level
            document.getElementById('riskScore').textContent = `${riskScore}%`;
            document.getElementById('riskLevel').textContent = riskLevel;
            
            // Update styling based on risk level
            let textColor, riskText;
            if (riskLevel === 'High Risk') {
                textColor = 'text-red-600';
                riskText = 'This student shows several risk factors for dropping out. Immediate intervention is recommended.';
            } else if (riskLevel === 'Moderate Risk') {
                textColor = 'text-yellow-600';
                riskText = 'This student shows some risk factors. Monitoring and support are recommended.';
            } else {
                textColor = 'text-green-600';
                riskText = 'This student shows minimal risk factors for dropping out.';
            }
            
            document.getElementById('riskLevel').className = `text-lg font-medium ${textColor}`;
            document.getElementById('riskScore').className = `text-4xl font-bold mb-2 ${textColor}`;
            
            // Add detailed feedback if factors are available
            if (result.factors) {
                const academicScore = Math.round(result.factors.academic);
                const behavioralScore = Math.round(result.factors.behavioral);
                const personalScore = Math.round(result.factors.personal);
                
                riskText += `\n\nRisk Breakdown:\n`;
                riskText += `â€¢ Academic: ${academicScore}%\n`;
                riskText += `â€¢ Behavioral: ${behavioralScore}%\n`;
                riskText += `â€¢ Personal: ${personalScore}%`;
                
                // Log detailed factors for debugging
                console.log('Detailed risk factors:', result.factors);
            }
            
            document.getElementById('riskFeedback').innerHTML = riskText.replace(/\n/g, '<br>');
        }

        // Initial calculation
        calculateRisk();
        
        // Initialize notes from localStorage
        let notes = [];
        if (localStorage.getItem('notes')) {
            notes = JSON.parse(localStorage.getItem('notes'));
            renderNotes();
        }
        
        // Initialize reminders from localStorage and check for due reminders
        let reminders = [];
        if (localStorage.getItem('reminders')) {
            reminders = JSON.parse(localStorage.getItem('reminders'));
            renderReminders();
            checkReminders();
        }
        
        // Initialize goals from localStorage
        window.goals = [];
        if (localStorage.getItem('goals')) {
            window.goals = JSON.parse(localStorage.getItem('goals'));
            renderGoals();
        }
        
        // Goal Management Functions
        function openGoalModal(goalId = null) {
            // Ensure goals is properly initialized
            if (!window.goals) {
                window.goals = goals;
                window.goals = JSON.parse(localStorage.getItem('goals')) || [];
            }
            const modal = document.getElementById('goal-modal');
            const form = document.getElementById('goal-form');
            const modalTitle = document.getElementById('modal-title');
            
            if (goalId) {
                // Edit mode
                const goal = goals.find(g => g.id === goalId);
                if (goal) {
                    document.getElementById('goal-id').value = goal.id;
                    document.getElementById('goal-title').value = goal.title;
                    document.getElementById('current-progress').value = goal.currentProgress;
                    document.getElementById('target-progress').value = goal.targetProgress;
                    modalTitle.textContent = 'Edit Goal';
                }
            } else {
                // Add new goal mode
                form.reset();
                document.getElementById('goal-id').value = '';
                modalTitle.textContent = 'Add New Goal';
            }
            
            modal.classList.remove('hidden');
        }
        
        function closeGoalModal() {
            document.getElementById('goal-modal').classList.add('hidden');
        }
        
        function saveGoal(event) {
            event.preventDefault();
            
            // Ensure goals is properly initialized
            if (!window.goals) {
                window.goals = JSON.parse(localStorage.getItem('goals')) || [];
            }
            
            const goalId = document.getElementById('goal-id').value;
            const title = document.getElementById('goal-title').value;
            const currentProgress = parseInt(document.getElementById('current-progress').value) || 0;
            const targetProgress = parseInt(document.getElementById('target-progress').value) || 100;
            
            if (!title) {
                alert('Please enter a title for your goal');
                return;
            }
            
            const goal = {
                id: goalId || Date.now().toString(),
                title,
                currentProgress: Math.min(Math.max(0, currentProgress), 100),
                targetProgress: Math.max(10, Math.min(1000, targetProgress)),
                createdAt: goalId ? (goals.find(g => g.id === goalId)?.createdAt || new Date().toISOString()) : new Date().toISOString()
            };
            
            if (goalId) {
                // Update existing goal
                const index = goals.findIndex(g => g.id === goalId);
                if (index !== -1) {
                    goals[index] = goal;
                } else {
                    goals.push(goal);
                }
            } else {
                // Add new goal
                goals.push(goal);
            }
            
            try {
                // Save to localStorage
                localStorage.setItem('goals', JSON.stringify(goals));
                
                // Update UI
                renderGoals();
                closeGoalModal();
            } catch (e) {
                console.error('Error saving goal:', e);
                alert('Failed to save goal. Please try again.');
            }
        }
        
        function deleteGoal(goalId) {
            if (confirm('Are you sure you want to delete this goal?')) {
                // Ensure goals is properly initialized
                if (!window.goals) {
                    window.goals = JSON.parse(localStorage.getItem('goals')) || [];
                }
                
                // Filter out the goal to be deleted
                window.goals = window.goals.filter(goal => goal.id !== goalId);
                
                // Update localStorage
                localStorage.setItem('goals', JSON.stringify(window.goals));
                
                // Re-render the goals list
                renderGoals();
                
                // Update the quick actions dashboard if it's visible
                if (!document.getElementById('quick-actions').classList.contains('hidden')) {
                    updateQuickActionsDashboard();
                }
            }
        }
        
        function renderGoals() {
            // Ensure goals is properly initialized
            if (!window.goals) {
                window.goals = JSON.parse(localStorage.getItem('goals')) || [];
            }
            
            const container = document.getElementById('goals-container');
            const noGoals = document.getElementById('no-goals');
            
            if (goals.length === 0) {
                container.innerHTML = '';
                noGoals.classList.remove('hidden');
                return;
            }
            
            noGoals.classList.add('hidden');
            container.innerHTML = goals.map(goal => {
                const progress = Math.min(100, Math.round((goal.currentProgress / goal.targetProgress) * 100));
                let statusClass = 'bg-red-500';
                let statusText = 'Needs Work';
                
                if (progress >= 100) {
                    statusClass = 'bg-green-600';
                    statusText = 'Completed';
                } else if (progress >= 70) {
                    statusClass = 'bg-blue-500';
                    statusText = 'On Track';
                } else if (progress >= 40) {
                    statusClass = 'bg-yellow-500';
                    statusText = 'In Progress';
                }
                
                return `
                    <div class="goal-card bg-white p-4 rounded-lg shadow border border-gray-200">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-semibold text-lg text-gray-800">${goal.title}</h3>
                            <div class="flex space-x-2">
                                <span class="text-xs px-2 py-1 ${statusClass === 'bg-green-600' ? 'bg-green-100 text-green-800' : statusClass === 'bg-blue-500' ? 'bg-blue-100 text-blue-800' : statusClass === 'bg-yellow-500' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'} rounded-full">
                                    ${statusText}
                                </span>
                                <button onclick="openGoalModal('${goal.id}')" class="text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteGoal('${goal.id}')" class="text-red-600 hover:text-red-800">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mb-2">
                            <div class="h-2.5 rounded-full ${statusClass}" style="width: ${progress}%"></div>
                        </div>
                        <div class="flex justify-between text-sm text-gray-600">
                            <span>${goal.currentProgress}% Complete</span>
                            <span>Target: ${goal.targetProgress}%</span>
                        </div>
                    </div>
                `;
            }).join('');
        }
        // Notes Management Functions
        function openNoteModal(noteId = null) {
            const modal = document.getElementById('note-modal');
            const form = document.getElementById('note-form');
            const modalTitle = document.getElementById('note-modal-title');
            
            if (noteId) {
                // Edit mode
                const note = notes.find(n => n.id === noteId);
                if (note) {
                    document.getElementById('note-id').value = note.id;
                    document.getElementById('note-title').value = note.title || '';
                    document.getElementById('note-content').value = note.content;
                    modalTitle.textContent = 'Edit Note';
                }
            } else {
                // Add new note mode
                form.reset();
                document.getElementById('note-id').value = '';
                modalTitle.textContent = 'Add New Note';
            }
            
            modal.classList.remove('hidden');
        }
        
        function closeNoteModal() {
            document.getElementById('note-modal').classList.add('hidden');
        }
        
        function saveNote(event) {
            event.preventDefault();
            
            const noteId = document.getElementById('note-id').value;
            const title = document.getElementById('note-title').value.trim();
            const content = document.getElementById('note-content').value.trim();
            
            const note = {
                id: noteId || Date.now().toString(),
                title: title || 'Untitled Note',
                content,
                createdAt: noteId ? notes.find(n => n.id === noteId).createdAt : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            if (noteId) {
                // Update existing note
                const index = notes.findIndex(n => n.id === noteId);
                if (index !== -1) {
                    notes[index] = note;
                }
            } else {
                // Add new note
                notes.unshift(note); // Add to beginning of array to show newest first
            }
            
            // Save to localStorage
            localStorage.setItem('notes', JSON.stringify(notes));
            
            // Update UI
            renderNotes();
            closeNoteModal();
        }
        
        function deleteNote(noteId) {
            if (confirm('Are you sure you want to delete this note?')) {
                notes = notes.filter(note => note.id !== noteId);
                localStorage.setItem('notes', JSON.stringify(notes));
                renderNotes();
            }
        }
        
        function renderNotes() {
            const container = document.getElementById('notes-container');
            const noNotes = document.getElementById('no-notes');
            
            if (notes.length === 0) {
                container.innerHTML = '';
                noNotes.classList.remove('hidden');
                return;
            }
            
            noNotes.classList.add('hidden');
            container.innerHTML = notes.map(note => {
                const date = new Date(note.updatedAt);
                const formattedDate = date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                return `
                    <div class="bg-white p-4 rounded-lg shadow border border-gray-200">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-semibold text-lg text-gray-800">${note.title}</h3>
                            <div class="flex space-x-2">
                                <button onclick="openNoteModal('${note.id}')" class="text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteNote('${note.id}')" class="text-red-600 hover:text-red-800">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-2 whitespace-pre-line">${note.content.replace(/\n/g, '<br>')}</p>
                        <p class="text-xs text-gray-400 text-right">Last updated: ${formattedDate}</p>
                    </div>
                `;
            }).join('');
        }
    
        // Reminders & Alerts Functions
        // Removed duplicate declaration of reminders array
        
        function openReminderModal(reminderId = null) {
            const modal = document.getElementById('reminder-modal');
            const form = document.getElementById('reminder-form');
            const title = document.getElementById('reminder-modal-title');
            
            if (reminderId) {
                // Edit existing reminder
                const reminder = reminders.find(r => r.id === reminderId);
                if (reminder) {
                    title.textContent = 'Edit Reminder';
                    form.elements['reminder-id'].value = reminder.id;
                    form.elements['reminder-title'].value = reminder.title;
                    form.elements['reminder-date'].value = reminder.date;
                    form.elements['reminder-time'].value = reminder.time;
                    form.elements['reminder-priority'].value = reminder.priority;
                }
            } else {
                // New reminder - set default values
                title.textContent = 'Add New Reminder';
                form.reset();
                
                // Set default date to today
                const now = new Date();
                const dateStr = now.toISOString().split('T')[0];
                const timeStr = now.toTimeString().substring(0, 5);
                
                form.elements['reminder-date'].value = dateStr;
                form.elements['reminder-time'].value = timeStr;
                form.elements['reminder-priority'].value = 'medium';
            }
            
            modal.classList.remove('hidden');
        }
        
        function closeReminderModal() {
            document.getElementById('reminder-modal').classList.add('hidden');
        }
        
        function saveReminder(event) {
            event.preventDefault();
            
            const form = event.target;
            const id = form.elements['reminder-id'].value || Date.now().toString();
            const title = form.elements['reminder-title'].value.trim();
            const date = form.elements['reminder-date'].value;
            const time = form.elements['reminder-time'].value;
            const priority = form.elements['reminder-priority'].value;
            
            if (!title) {
                alert('Please enter a title for the reminder');
                return;
            }
            
            const reminder = {
                id,
                title,
                date,
                time,
                priority,
                completed: false
            };
            
            // Check if this is an edit or new reminder
            const existingIndex = reminders.findIndex(r => r.id === id);
            if (existingIndex > -1) {
                reminders[existingIndex] = reminder;
            } else {
                reminders.push(reminder);
            }
            
            // Save to localStorage
            localStorage.setItem('reminders', JSON.stringify(reminders));
            
            // Update UI
            renderReminders();
            
            // Close modal
            closeReminderModal();
            
            // Check if we need to set up notifications for this reminder
            scheduleNotification(reminder);
        }
        
        function deleteReminder(reminderId) {
            if (confirm('Are you sure you want to delete this reminder?')) {
                reminders = reminders.filter(r => r.id !== reminderId);
                localStorage.setItem('reminders', JSON.stringify(reminders));
                renderReminders();
            }
        }
        
        function toggleReminderComplete(reminderId) {
            const reminder = reminders.find(r => r.id === reminderId);
            if (reminder) {
                reminder.completed = !reminder.completed;
                localStorage.setItem('reminders', JSON.stringify(reminders));
                renderReminders();
            }
        }
        
        function renderReminders() {
            const container = document.getElementById('reminders-list');
            const noReminders = document.getElementById('no-reminders');
            
            if (!reminders || reminders.length === 0) {
                container.innerHTML = '';
                noReminders.classList.remove('hidden');
                return;
            }
            
            // Sort reminders by date and time (soonest first)
            const sortedReminders = [...reminders].sort((a, b) => {
                return new Date(a.date + 'T' + a.time) - new Date(b.date + 'T' + b.time);
            });
            
            container.innerHTML = sortedReminders.map(reminder => {
                const dateTime = new Date(reminder.date + 'T' + reminder.time);
                const formattedDate = dateTime.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const priorityColors = {
                    high: 'bg-red-100 text-red-800',
                    medium: 'bg-yellow-100 text-yellow-800',
                    low: 'bg-blue-100 text-blue-800'
                };
                
                return `
                    <div class="border rounded-lg p-4 ${reminder.completed ? 'bg-gray-50' : 'bg-white'} ${reminder.completed ? 'opacity-70' : ''}">
                        <div class="flex items-start justify-between">
                            <div class="flex items-start space-x-3">
                                <input 
                                    type="checkbox" 
                                    class="mt-1 h-5 w-5 text-blue-600 rounded"
                                    ${reminder.completed ? 'checked' : ''}
                                    onchange="toggleReminderComplete('${reminder.id}')"
                                >
                                <div>
                                    <h3 class="font-medium ${reminder.completed ? 'line-through text-gray-500' : 'text-gray-800'}">
                                        ${reminder.title}
                                    </h3>
                                    <p class="text-sm text-gray-500">
                                        <i class="far fa-clock mr-1"></i> ${formattedDate}
                                    </p>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <span class="px-2 py-1 text-xs rounded-full ${priorityColors[reminder.priority] || 'bg-gray-100 text-gray-800'}">
                                    ${reminder.priority.charAt(0).toUpperCase() + reminder.priority.slice(1)}
                                </span>
                                <button onclick="openReminderModal('${reminder.id}')" class="text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteReminder('${reminder.id}')" class="text-red-600 hover:text-red-800">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            noReminders.classList.add('hidden');
        }
        
        function scheduleNotification(reminder) {
            if (!('Notification' in window)) {
                console.log('This browser does not support desktop notification');
                return;
            }
            
            // Request permission if not already granted
            if (Notification.permission !== 'granted') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        createNotification(reminder);
                    }
                });
            } else {
                createNotification(reminder);
            }
        }
        
        function createNotification(reminder) {
            const now = new Date();
            const reminderTime = new Date(reminder.date + 'T' + reminder.time);
            const timeUntil = reminderTime - now;
            
            // Only schedule if the reminder is in the future
            if (timeUntil > 0) {
                setTimeout(() => {
                    if (Notification.permission === 'granted') {
                        new Notification('Reminder: ' + reminder.title, {
                            body: reminder.title,
                            icon: '/favicon.ico', // You can add an icon
                            requireInteraction: true
                        });
                    } else {
                        alert('Reminder: ' + reminder.title);
                    }
                }, timeUntil);
            }
        }
        
        function checkReminders() {
            const now = new Date();
            
            reminders.forEach(reminder => {
                const reminderTime = new Date(reminder.date + 'T' + reminder.time);
                
                // If the reminder is in the past and not completed, mark it as overdue
                if (reminderTime < now && !reminder.completed) {
                    // You could add visual indication for overdue reminders here
                    console.log('Overdue reminder:', reminder.title);
                }
            });
        }
        
        // Update quick actions dashboard
        function updateQuickActionsDashboard() {
            // Update active goals count
            const goals = JSON.parse(localStorage.getItem('goals') || '[]');
            document.getElementById('active-goals-count').textContent = goals.length;
            
            // Update upcoming reminders count
            const reminders = JSON.parse(localStorage.getItem('reminders') || '[]');
            const now = new Date();
            const upcomingReminders = reminders.filter(reminder => {
                const reminderDate = new Date(reminder.date + 'T' + reminder.time);
                return reminderDate > now && !reminder.completed;
            });
            document.getElementById('upcoming-reminders-count').textContent = upcomingReminders.length;
            
            // Update recent activities
            const activities = [];
            
            // Add recent goals
            const recentGoals = goals
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                .slice(0, 3)
                .map(goal => ({
                    type: 'goal',
                    title: `Goal: ${goal.title}`,
                    time: new Date(goal.createdAt).toLocaleString(),
                    icon: 'fas fa-bullseye',
                    color: 'text-blue-500'
                }));
            
            // Add recent reminders
            const recentReminders = reminders
                .sort((a, b) => new Date(b.date + 'T' + b.time) - new Date(a.date + 'T' + a.time))
                .slice(0, 3)
                .map(reminder => ({
                    type: 'reminder',
                    title: `Reminder: ${reminder.title}`,
                    time: new Date(reminder.date + 'T' + reminder.time).toLocaleString(),
                    icon: 'fas fa-bell',
                    color: 'text-yellow-500'
                }));
            
            // Combine and sort activities
            const allActivities = [...recentGoals, ...recentReminders]
                .sort((a, b) => new Date(b.time) - new Date(a.time))
                .slice(0, 5);
            
            // Update activities count
            document.getElementById('recent-activities-count').textContent = allActivities.length;
            
            // Render activities
            const activitiesContainer = document.getElementById('recent-activities');
            if (allActivities.length > 0) {
                activitiesContainer.innerHTML = allActivities.map(activity => `
                    <div class="flex items-center p-2 hover:bg-gray-50 rounded-lg">
                        <div class="p-2 rounded-full ${activity.color} bg-opacity-20 mr-3">
                            <i class="${activity.icon}"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-800">${activity.title}</p>
                            <p class="text-xs text-gray-500">${activity.time}</p>
                        </div>
                    </div>
                `).join('');
            } else {
                activitiesContainer.innerHTML = `
                    <div class="text-center py-4 text-gray-500">
                        <p>No recent activities yet</p>
                    </div>
                `;
            }
        }
        
        // Update dashboard when quick actions tab is clicked
        document.querySelector('[data-tab="quick-actions"]').addEventListener('click', updateQuickActionsDashboard);
        
        // Check for reminders every minute
        setInterval(checkReminders, 60000);
        
        // Study Planner Functions
        let currentWeekStart = getStartOfWeek(new Date());
        let studySessions = JSON.parse(localStorage.getItem('studySessions') || '[]');
        
        // Initialize the study planner when the tab is clicked
        document.querySelector('[data-tab="study-planner"]').addEventListener('click', function() {
            renderWeekView();
            renderStudySessions();
        });
        
        // Initialize the current week display and render the initial view
        updateWeekDisplay();
        renderWeekView();
        renderStudySessions();
        
        function openStudySessionModal(sessionId = null) {
            const modal = document.getElementById('study-session-modal');
            const form = document.getElementById('study-session-form');
            const title = document.getElementById('session-modal-title');
            
            if (sessionId) {
                // Edit mode
                const session = studySessions.find(s => s.id === sessionId);
                if (session) {
                    document.getElementById('session-id').value = session.id;
                    document.getElementById('session-title').value = session.title;
                    document.getElementById('session-date').value = session.date;
                    document.getElementById('session-time').value = session.time;
                    document.getElementById('session-duration').value = session.duration || 60;
                    document.getElementById('session-subject').value = session.subject || '';
                    document.getElementById('session-notes').value = session.notes || '';
                    title.textContent = 'Edit Study Session';
                }
            } else {
                // Add new session mode
                form.reset();
                document.getElementById('session-id').value = '';
                // Set default date to today
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('session-date').value = today;
                // Set default time to next hour
                const nextHour = new Date();
                nextHour.setHours(nextHour.getHours() + 1, 0, 0, 0);
                document.getElementById('session-time').value = 
                    nextHour.toTimeString().substring(0, 5);
                title.textContent = 'Add Study Session';
            }
            
            modal.classList.remove('hidden');
        }
        
        function closeStudySessionModal() {
            document.getElementById('study-session-modal').classList.add('hidden');
        }
        
        function saveStudySession(event) {
            event.preventDefault();
            
            const form = event.target;
            const id = form.querySelector('#session-id').value || Date.now().toString();
            const title = form.querySelector('#session-title').value.trim();
            const date = form.querySelector('#session-date').value;
            const time = form.querySelector('#session-time').value;
            const duration = parseInt(form.querySelector('#session-duration').value) || 60;
            const subject = form.querySelector('#session-subject').value.trim();
            const notes = form.querySelector('#session-notes').value.trim();
            
            if (!title || !date || !time) {
                alert('Please fill in all required fields');
                return;
            }
            
            const session = {
                id,
                title,
                date,
                time,
                duration,
                subject,
                notes,
                createdAt: new Date().toISOString()
            };
            
            // Check if this is an edit or new session
            const existingIndex = studySessions.findIndex(s => s.id === id);
            if (existingIndex > -1) {
                studySessions[existingIndex] = session;
            } else {
                studySessions.push(session);
            }
            
            // Save to localStorage
            localStorage.setItem('studySessions', JSON.stringify(studySessions));
            
            // Update UI
            renderStudySessions();
            
            // Close modal and reset form
            closeStudySessionModal();
            form.reset();
        }
        
        function deleteStudySession(sessionId) {
            if (confirm('Are you sure you want to delete this study session?')) {
                studySessions = studySessions.filter(s => s.id !== sessionId);
                localStorage.setItem('studySessions', JSON.stringify(studySessions));
                renderStudySessions();
            }
        }
        
        function renderStudySessions() {
            const container = document.getElementById('sessions-list');
            const noSessions = document.getElementById('no-sessions');
            
            // Filter sessions for the current week
            const weekStart = new Date(currentWeekStart);
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);
            
            const weekSessions = studySessions.filter(session => {
                const sessionDate = new Date(session.date);
                return sessionDate >= weekStart && sessionDate <= weekEnd;
            });
            
            if (weekSessions.length === 0) {
                container.innerHTML = '';
                noSessions.classList.remove('hidden');
                return;
            }
            
            // Sort sessions by date and time
            weekSessions.sort((a, b) => {
                const dateA = new Date(a.date + 'T' + a.time);
                const dateB = new Date(b.date + 'T' + b.time);
                return dateA - dateB;
            });
            
            // Group sessions by date
            const sessionsByDate = weekSessions.reduce((acc, session) => {
                const date = new Date(session.date).toDateString();
                if (!acc[date]) {
                    acc[date] = [];
                }
                acc[date].push(session);
                return acc;
            }, {});
            
            // Render sessions
            container.innerHTML = '';
            
            Object.entries(sessionsByDate).forEach(([date, sessions]) => {
                const dateHeader = document.createElement('div');
                dateHeader.className = 'text-sm font-medium text-gray-500 mb-2 mt-4';
                dateHeader.textContent = new Date(date).toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    month: 'short', 
                    day: 'numeric' 
                });
                container.appendChild(dateHeader);
                
                sessions.forEach(session => {
                    const sessionElement = document.createElement('div');
                    sessionElement.className = 'bg-white border rounded-lg p-4 mb-3 shadow-sm hover:shadow transition-shadow';
                    
                    const time = new Date(session.date + 'T' + session.time);
                    const formattedTime = time.toLocaleTimeString('en-US', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    
                    sessionElement.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="font-medium text-gray-900">${session.title}</div>
                                <div class="flex items-center text-sm text-gray-500 mt-1">
                                    <i class="far fa-clock mr-1"></i>
                                    <span>${formattedTime} â€¢ ${session.duration} min</span>
                                    ${session.subject ? `<span class="ml-2 px-2 py-0.5 bg-blue-100 text-blue-800 text-xs rounded-full">${session.subject}</span>` : ''}
                                </div>
                                ${session.notes ? `<p class="mt-2 text-sm text-gray-600">${session.notes}</p>` : ''}
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="openStudySessionModal('${session.id}')" class="text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteStudySession('${session.id}')" class="text-red-600 hover:text-red-800">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(sessionElement);
                });
            });
            
            noSessions.classList.add('hidden');
        }
        
        function changeWeek(weeks) {
            currentWeekStart.setDate(currentWeekStart.getDate() + (weeks * 7));
            updateWeekDisplay();
            renderWeekView();
            renderStudySessions();
        }
        
        function updateWeekDisplay() {
            const weekStart = new Date(currentWeekStart);
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const weekStartCopy = new Date(weekStart);
            const weekEndCopy = new Date(weekEnd);
            weekEndCopy.setHours(23, 59, 59, 999);
            
            const isCurrentWeek = today >= weekStartCopy && today <= weekEndCopy;
            
            const weekDisplay = document.getElementById('current-week');
            if (isCurrentWeek) {
                weekDisplay.textContent = 'This Week';
            } else {
                weekDisplay.textContent = `${weekStart.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} - 
                                         ${weekEnd.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}`;
                
                // Add year if it's a different year
                if (weekStart.getFullYear() !== weekEnd.getFullYear()) {
                    weekDisplay.textContent += `, ${weekEnd.getFullYear()}`;
                } else if (weekStart.getFullYear() !== new Date().getFullYear()) {
                    weekDisplay.textContent += `, ${weekStart.getFullYear()}`;
                }
            }
        }
        
        function renderWeekView() {
            const daysContainer = document.getElementById('week-days');
            daysContainer.innerHTML = '';
            
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const today = new Date();
            const currentDate = new Date(currentWeekStart);
            
            for (let i = 0; i < 7; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'text-center';
                
                const isToday = currentDate.toDateString() === today.toDateString();
                const isCurrentMonth = currentDate.getMonth() === today.getMonth();
                
                dayElement.innerHTML = `
                    <div class="text-sm font-medium text-gray-500">${days[i]}</div>
                    <div class="mt-1 w-10 h-10 flex items-center justify-center mx-auto rounded-full 
                                ${isToday ? 'bg-blue-600 text-white' : 'hover:bg-gray-100'} 
                                ${isCurrentMonth ? 'text-gray-900' : 'text-gray-400'}">
                        ${currentDate.getDate()}
                    </div>
                `;
                
                daysContainer.appendChild(dayElement);
                currentDate.setDate(currentDate.getDate() + 1);
            }
        }
        
        function getStartOfWeek(date) {
            const d = new Date(date);
            // Set to the first day of the week (Monday)
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1); // Adjust when day is Sunday
            const firstDay = new Date(d.setDate(diff));
            // Set time to 00:00:00 to avoid timezone issues
            firstDay.setHours(0, 0, 0, 0);
            return firstDay;
        }
        // Mobile menu toggle
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuButton = document.querySelector('[aria-controls="mobile-menu"]');
            const mobileMenu = document.getElementById('mobile-menu');
            
            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', function() {
                    const isExpanded = this.getAttribute('aria-expanded') === 'true';
                    this.setAttribute('aria-expanded', !isExpanded);
                    mobileMenu.classList.toggle('hidden');
                    mobileMenu.classList.toggle('block');
                });
            }
            
            // Show a welcome notification
            setTimeout(() => {
                showNotification('Welcome to Dropout Risk Analysis', 'Start analyzing student data to identify potential dropout risks.', 'info');
            }, 1000);
        });
        
        // Notification function
        function showNotification(title, message, type = 'info') {
            const container = document.getElementById('notification-container');
            const notification = document.createElement('div');
            const types = {
                info: 'bg-blue-100 border-blue-400 text-blue-700',
                success: 'bg-green-100 border-green-400 text-green-700',
                warning: 'bg-yellow-100 border-yellow-400 text-yellow-700',
                error: 'bg-red-100 border-red-400 text-red-700'
            };
            
            notification.className = `border-l-4 p-4 rounded shadow-lg ${types[type] || types.info} max-w-xs`;
            notification.innerHTML = `
                <div class="flex">
                    <div class="flex-shrink-0">
                        <i class="fas ${type === 'info' ? 'fa-info-circle' : type === 'success' ? 'fa-check-circle' : type === 'warning' ? 'fa-exclamation-triangle' : 'fa-exclamation-circle'}"></i>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium">${title}</h3>
                        <div class="mt-1 text-sm">
                            <p>${message}</p>
                        </div>
                    </div>
                    <div class="ml-4 flex-shrink-0 flex">
                        <button class="inline-flex text-gray-400 focus:outline-none focus:text-gray-500" onclick="this.parentElement.parentElement.parentElement.remove()">
                            <span class="sr-only">Close</span>
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `;
            
            container.appendChild(notification);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }
        
        // Show/hide loading overlay
        function setLoading(isLoading) {
            const overlay = document.getElementById('loading-overlay');
            if (isLoading) {
                overlay.classList.remove('hidden');
            } else {
                overlay.classList.add('hidden');
            }
        }
    </script>
    
    <!-- Reminder Modal -->
    <div id="reminder-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800" id="reminder-modal-title">Add New Reminder</h3>
                <button onclick="closeReminderModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="reminder-form" onsubmit="saveReminder(event)" class="space-y-4">
                <input type="hidden" name="reminder-id">
                
                <div>
                    <label for="reminder-title" class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                    <input type="text" id="reminder-title" name="reminder-title" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="reminder-date" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                        <input type="date" id="reminder-date" name="reminder-date" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label for="reminder-time" class="block text-sm font-medium text-gray-700 mb-1">Time</label>
                        <input type="time" id="reminder-time" name="reminder-time" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
                
                <div>
                    <label for="reminder-priority" class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                    <select id="reminder-priority" name="reminder-priority"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
                
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeReminderModal()"
                            class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Cancel
                    </button>
                    <button type="submit"
                            class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Save Reminder
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Study Planner Tab -->
    <div id="study-planner" class="tab-content hidden">
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Study Planner</h2>
                <button onclick="openStudySessionModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center">
                    <i class="fas fa-plus mr-2"></i> Add Study Session
                </button>
            </div>
            
            <!-- Week Navigation -->
            <div class="flex justify-between items-center mb-6 bg-gray-50 p-3 rounded-lg">
                <button onclick="changeWeek(-1)" class="p-2 rounded-full hover:bg-gray-200">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <h3 id="current-week" class="text-lg font-semibold">This Week</h3>
                <button onclick="changeWeek(1)" class="p-2 rounded-full hover:bg-gray-200">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            
            <!-- Calendar Grid -->
            <div class="grid grid-cols-1 md:grid-cols-7 gap-2 mb-6" id="week-days">
                <!-- Days will be populated by JavaScript -->
            </div>
            
            <!-- Study Sessions List -->
            <div id="study-sessions-container">
                <div class="text-center text-gray-500 py-8" id="no-sessions">
                    <i class="fas fa-calendar-plus text-4xl mb-2"></i>
                    <p>No study sessions scheduled for this week</p>
                    <button onclick="openStudySessionModal()" class="mt-4 text-blue-600 hover:text-blue-800 font-medium">
                        Add your first session
                    </button>
                </div>
                <div id="sessions-list" class="space-y-3"></div>
            </div>
        </div>
        
        <!-- Study Session Modal -->
        <div id="study-session-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
            <div class="bg-white rounded-lg p-6 w-full max-w-md">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800" id="session-modal-title">Add Study Session</h3>
                    <button onclick="closeStudySessionModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="study-session-form" onsubmit="saveStudySession(event)">
                    <input type="hidden" id="session-id">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="session-title">
                            Title <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="session-title" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="session-date">
                                Date <span class="text-red-500">*</span>
                            </label>
                            <input type="date" id="session-date" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="session-time">
                                Time <span class="text-red-500">*</span>
                            </label>
                            <input type="time" id="session-time" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="session-duration">
                            Duration (minutes) <span class="text-red-500">*</span>
                        </label>
                        <input type="number" id="session-duration" min="15" value="60" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="session-subject">
                            Subject/Course
                        </label>
                        <input type="text" id="session-subject"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="session-notes">
                            Notes
                        </label>
                        <textarea id="session-notes" rows="3"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    <div class="flex justify-end space-x-3 pt-2">
                        <button type="button" onclick="closeStudySessionModal()"
                            class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                            Cancel
                        </button>
                        <button type="submit"
                            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            Save Session
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</body>
</html>
